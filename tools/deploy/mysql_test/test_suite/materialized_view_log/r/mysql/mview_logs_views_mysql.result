create table t1(c1 int primary key, c2 int, c3 int, c4 int);
create table t2(c1 int, c2 int, c3 int, c4 int);
create table t3(c1 int primary key, c2 int, c3 int, c4 int);
create materialized view log on t1 with primary key, sequence (c2, c3) including new values;
create materialized view log on t2 with rowid including new values;
create materialized view log on t3 with primary key including new values purge start with sysdate() next sysdate() + interval 1 day;
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.DBA_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t1	mlog$_t1	NO	YES	YES	YES	YES	NO	NO	1	NULL	YES
test	t2	mlog$_t2	YES	NO	NO	YES	YES	NO	NO	1	NULL	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.CDB_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t1	mlog$_t1	NO	YES	YES	YES	YES	NO	NO	1	NULL	YES
test	t2	mlog$_t2	YES	NO	NO	YES	YES	NO	NO	1	NULL	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
drop materialized view log on t1;
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.DBA_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t2	mlog$_t2	YES	NO	NO	YES	YES	NO	NO	1	NULL	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.CDB_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t2	mlog$_t2	YES	NO	NO	YES	YES	NO	NO	1	NULL	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
drop materialized view log on t2;
create materialized view log on t1 with primary key, sequence (c2, c3) including new values purge start with sysdate();
create materialized view log on t2 with rowid, sequence (c2, c3) including new values purge next sysdate() + interval 1 day;
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.DBA_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t1	mlog$_t1	NO	YES	YES	YES	YES	NO	YES	0	NULL	YES
test	t2	mlog$_t2	YES	NO	YES	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
SELECT LOG_OWNER,MASTER,LOG_TABLE,ROWIDS,PRIMARY_KEY,FILTER_COLUMNS,SEQUENCE,INCLUDE_NEW_VALUES,PURGE_ASYNCHRONOUS,PURGE_DEFERRED,PURGE_START IS NULL,PURGE_INTERVAL,COMMIT_SCN_BASED FROM oceanbase.CDB_MVIEW_LOGS WHERE LOG_OWNER = 'test' AND MASTER IN ('t1', 't2', 't3') ORDER BY MASTER;
LOG_OWNER	MASTER	LOG_TABLE	ROWIDS	PRIMARY_KEY	FILTER_COLUMNS	SEQUENCE	INCLUDE_NEW_VALUES	PURGE_ASYNCHRONOUS	PURGE_DEFERRED	PURGE_START IS NULL	PURGE_INTERVAL	COMMIT_SCN_BASED
test	t1	mlog$_t1	NO	YES	YES	YES	YES	NO	YES	0	NULL	YES
test	t2	mlog$_t2	YES	NO	YES	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
test	t3	mlog$_t3	NO	YES	NO	YES	YES	NO	YES	0	sysdate() + interval 1 day	YES
drop materialized view log on t1;
drop materialized view log on t2;
drop materialized view log on t3;
drop table t1;
drop table t2;
drop table t3;
