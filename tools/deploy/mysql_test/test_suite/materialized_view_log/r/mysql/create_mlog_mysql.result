drop materialized view log on t1;
drop materialized view log on t2;
drop materialized view log on tjson1;
drop materialized view log on tgis1;
DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
DROP TABLE IF EXISTS tjson1;
DROP TABLE IF EXISTS tgis1;
CREATE TABLE t1 (
id int primary key,
name varchar(10),
age int
);
create materialized view log on t1 with primary key (age) excluding new values;
ERROR 0A000: create materialized view log excluding new values is not supported
create materialized view log on t1 with primary key (age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	NO	PRI	NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
select count(*) from t1;
count(*)
0
select count(*) from mlog$_t1;
count(*)
0
select count(*) from oceanbase.__all_mlog where mlog_id in (select table_id from oceanbase.__all_table where table_name='mlog$_t1');
count(*)
1
drop table t1;
ERROR 0A000: drop table with materialized view log is not supported
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id int primary key,
name varchar(10),
age int
);
insert into t1 values (1, 'Andy', 20), (2, 'Lucy', 18), (3, 'Mary', 24), (4, 'Jack', 30), (5, 'Rose', 26), (6, 'Tom', 19), (7, 'Lily', 28), (8, 'Abel', 35), (9, 'Hanna', 29), (10, 'Linda', 24);
create materialized view log on t1 with primary key (age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	NO	PRI	NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
select count(*) from t1;
count(*)
10
select count(*) from mlog$_t1;
count(*)
0
select count(*) from oceanbase.__all_mlog where mlog_id in (select table_id from oceanbase.__all_table where table_name='mlog$_t1');
count(*)
1
drop table t1;
ERROR 0A000: drop table with materialized view log is not supported
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id int,
name varchar(10),
age int
);
create materialized view log on t1 with (id, age);
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop materialized view log on t1;
create materialized view log on t1 with (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop materialized view log on t1;
create materialized view log on t1 with primary key (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop materialized view log on t1;
create materialized view log on t1 with rowid (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop materialized view log on t1;
create materialized view log on t1 with sequence (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop materialized view log on t1;
create materialized view log on t1 parallel 4 with (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
drop table t1;
ERROR 0A000: drop table with materialized view log is not supported
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id int,
name varchar(10),
age int
);
insert into t1 values (1, 'Andy', 20), (2, 'Lucy', 18), (3, 'Mary', 24), (4, 'Jack', 30), (5, 'Rose', 26), (6, 'Tom', 19), (7, 'Lily', 28), (8, 'Abel', 35), (9, 'Hanna', 29), (10, 'Linda', 24);
create materialized view log on t1 with sequence, rowid (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
select count(*) from t1;
count(*)
10
select count(*) from mlog$_t1;
count(*)
0
select count(*) from oceanbase.__all_mlog where mlog_id in (select table_id from oceanbase.__all_table where table_name='mlog$_t1');
count(*)
1
drop table t1;
ERROR 0A000: drop table with materialized view log is not supported
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id1 int,
age int,
id2 int,
name varchar(10),
primary key (id1, id2)
);
create materialized view log on t1 with primary key (age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id1	int(11)	NO	PRI	NULL
age	int(11)	YES		NULL
id2	int(11)	NO	PRI	NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
select count(*) from t1;
count(*)
0
select count(*) from mlog$_t1;
count(*)
0
select count(*) from oceanbase.__all_mlog where mlog_id in (select table_id from oceanbase.__all_table where table_name='mlog$_t1');
count(*)
1
drop table t1;
ERROR 0A000: drop table with materialized view log is not supported
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id int,
name varchar(10),
age int
)
partition by range(age)
(
partition p1 values less than(10),
partition p2 values less than(20),
partition p3 values less than(30),
partition p4 values less than(40),
partition p5 values less than(50)
);
create materialized view log on t1 with primary key (id, age) including new values;
desc mlog$_t1;
Field	Type	Null	Key	Default	Extra
id	int(11)	YES		NULL
age	int(11)	YES		NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
M_ROW$$	bigint unsigned	NO	PRI	NULL
select count(*) from oceanbase.__all_mlog where mlog_id in (select table_id from oceanbase.__all_table where table_name='mlog$_t1');
count(*)
1
insert into t1 values (1, 'Andy', 5), (2, 'Lucy', 10), (3, 'Mary', 24), (4, 'Jack', 30), (5, 'Rose', 26), (6, 'Tom', 19), (7, 'Lily', 38), (8, 'Abel', 45), (9, 'Hanna', 29), (10, 'Linda', 40);
select count(*) from t1;
count(*)
10
select count(*) from mlog$_t1;
count(*)
10
select id, age from t1 partition(p1);
id	age
1	5
select id, age from mlog$_t1 partition(p1);
id	age
1	5
select id, age from t1 partition(p2);
id	age
2	10
6	19
select id, age from mlog$_t1 partition(p2);
id	age
2	10
6	19
select id, age from t1 partition(p3);
id	age
3	24
5	26
9	29
select id, age from mlog$_t1 partition(p3);
id	age
3	24
5	26
9	29
select id, age from t1 partition(p4);
id	age
4	30
7	38
select id, age from mlog$_t1 partition(p4);
id	age
4	30
7	38
select id, age from t1 partition(p5);
id	age
8	45
10	40
select id, age from mlog$_t1 partition(p5);
id	age
8	45
10	40
drop materialized view log on t1;
drop table t1;
DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (
id int primary key,
name varchar(10),
age int
);
create view v1 as select id, age from t1;
create materialized view log on v1 with primary key (age) including new values;
ERROR 0A000: create materialized view log on a non-user table or mview is not supported
drop view v1;
create index idx1 on t1(id, age) local;
create materialized view log on idx1 with primary key (age) including new values;
ERROR 42S02: Table 'test.idx1' doesn't exist
drop index idx1 on t1;
create materialized view log on t1 with primary key (age) including new values;
create materialized view log on mlog$_t1 with primary key (age) including new values;
ERROR 0A000: create materialized view log on a non-user table or mview is not supported
drop materialized view log on t1;
CREATE TABLE t2 (
id int primary key,
gen_col int generated always as (id * 10) virtual
);
create materialized view log on t2 with (gen_col) including new values;
ERROR 0A000: create materialized view log on generated columns is not supported
DROP TABLE t2;
CREATE TABLE t2 (
id int primary key,
gen_col int generated always as (id * 10) stored
);
create materialized view log on t2 with (gen_col) including new values;
ERROR 0A000: create materialized view log on generated columns is not supported
create materialized view log on t2 including new values;
drop materialized view log on t2;
DROP TABLE t2;
create table t1234567890123456789012345678901234567890123456789012len58 (
id int primary key,
name varchar(10),
age int
);
create materialized view log on t1234567890123456789012345678901234567890123456789012len58;
desc mlog$_t1234567890123456789012345678901234567890123456789012len58;
Field	Type	Null	Key	Default	Extra
id	int(11)	NO	PRI	NULL
SEQUENCE$$	bigint(20)	NO	PRI	NULL
DMLTYPE$$	varchar(1)	NO		NULL
OLD_NEW$$	varchar(1)	NO		NULL
drop materialized view log on t1234567890123456789012345678901234567890123456789012len58;
drop table t1234567890123456789012345678901234567890123456789012len58;
create table t12345678901234567890123456789012345678901234567890123len59 (
id int primary key,
name varchar(10),
age int
);
create materialized view log on t12345678901234567890123456789012345678901234567890123len59;
ERROR 42000: Identifier name 'mlog$_t12345678901234567890123456789012345678901234567890123len59' is too long
drop table t12345678901234567890123456789012345678901234567890123len59;
DROP TABLE t1;
