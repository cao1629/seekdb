#owner: lana.lgx
#owner group: data

--source mysql_test/include/ignore_drop_mlog_err_mysql.inc
drop materialized view log on t1;
--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings
CREATE TABLE t1 (
  id int primary key,
  name varchar(10),
  age int
);

# create mlog on table
create materialized view log on t1 with primary key (age) including new values;
desc mlog$_t1;

# insert data to empty base table
insert into t1 values (1, 'Lucy', 21), (2, 'Tommy', 24), (3, 'Jack', 30), (4, 'May', 22), (5, 'Rose', 23), (6, 'Grace', 34), (7, 'Nancy', 24), (8, 'Jones', 32), (9, 'Jerry', 23), (10, 'Marry', 25);

select count(*) from t1;
select dmltype$$, old_new$$, id from mlog$_t1;

# insert data to mlog directly is not supported
--error 1235
insert into mlog$_t1 values (1, 'I', 'N', 20, 30);
--error 1235
insert into mlog$_t1 values (10, 'U', 'N', 15, 25);
--error 1235
insert into mlog$_t1 values (100, 'D', 'O', 40, 20);

# update data of mlog is not supported
--error 1235
update mlog$_t1 set age = age + 1;

# delete data from mlog directly is not supported
--error 1235
delete from mlog$_t1;

# cleanup
drop materialized view log on t1;
drop table t1;