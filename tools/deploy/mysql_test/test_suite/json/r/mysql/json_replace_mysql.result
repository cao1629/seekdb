# ----------------------------------------------------------------------
# Test of JSON_REPLACE function.
# ----------------------------------------------------------------------
select json_replace('[1,2,3]', NULL, cast(1 as json));
json_replace('[1,2,3]', NULL, cast(1 as json))
NULL
select json_replace('[1,2,3]', '$[2]', NULL);
json_replace('[1,2,3]', '$[2]', NULL)
[1, 2, null]
select json_replace('[1,2,3]', '$[2]', 4);
json_replace('[1,2,3]', '$[2]', 4)
[1, 2, 4]
select json_replace('[1,2,3]', '$[3]', 4);
json_replace('[1,2,3]', '$[3]', 4)
[1, 2, 3]
select json_replace('[1,2,3]', '$[10]', 4);
json_replace('[1,2,3]', '$[10]', 4)
[1, 2, 3]
select json_replace('{"c":4}', '$.c', 5);
json_replace('{"c":4}', '$.c', 5)
{"c": 5}
select json_replace('{"c":4}', '$.a', 5);
json_replace('{"c":4}', '$.a', 5)
{"c": 4}
select json_replace('1', '$', 4);
json_replace('1', '$', 4)
4
select json_replace('1', '$[0]', 4);
json_replace('1', '$[0]', 4)
4
select json_replace('1', '$[1]', 4);
json_replace('1', '$[1]', 4)
1
select json_replace('1', '$[10]', '4', '$[11]', 5);
json_replace('1', '$[10]', '4', '$[11]', 5)
1
select json_replace('[1,2,3]', '$[2][0]', 4);
json_replace('[1,2,3]', '$[2][0]', 4)
[1, 2, 4]
select json_replace('[1,2,3]', '$[2][2]', 4);
json_replace('[1,2,3]', '$[2][2]', 4)
[1, 2, 3]
select json_replace('{"a": 3}', '$.a[0]', 4);
json_replace('{"a": 3}', '$.a[0]', 4)
{"a": 4}
select json_replace('{"a": 3}', '$.a[1]', 4, '$.a[2]', '5');
json_replace('{"a": 3}', '$.a[1]', 4, '$.a[2]', '5')
{"a": 3}
SELECT JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.c',
true);
JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.c',
true)
{"a": "foo", "b": [1, 2, 3]}
SELECT JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.a[0]',
true);
JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.a[0]',
true)
{"a": true, "b": [1, 2, 3]}
SELECT JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.b[5]',
true);
JSON_REPLACE('{ "a" : "foo", "b" : [ 1, 2, 3 ] }',
'$.b[5]',
true)
{"a": "foo", "b": [1, 2, 3]}
select json_replace(NULL);
ERROR 42000: Incorrect parameter count in the call to native function 'json_replace'
select json_replace(NULL, NULL);
ERROR 42000: Incorrect parameter count in the call to native function 'json_replace'
select json_replace(NULL, NULL, NULL, NULL);
ERROR 42000: Incorrect parameter count in the call to native function 'json_replace'
select json_replace(UNHEX(""), '$[0]', 4);
ERROR 22032: Cannot create a JSON value from a string.
drop table if exists json_test;
create table json_test (id int primary key, data json);
insert into json_test values(1, '{ "a" : "foo", "b" : [ 1, 2, 3 ] }');
update json_test set data = json_replace(data, '$.a', 'woo');
select * from json_test;
id	data
1	{"a": "woo", "b": [1, 2, 3]}
set log_row_value_options="partial_json";
update json_test set data = json_replace(data, '$.a', 'xoo') where id = 1;
select * from json_test;
id	data
1	{"a": "xoo", "b": [1, 2, 3]}
insert into json_test values(2, '{ "a" : "foo", "b" : [ 1, 2, 3 ] , "c" : 100}');
update json_test set data = json_replace(json_replace(data, '$.a', 'xoo'), '$.c', 200) where id = 2;
select * from json_test where id=2;
id	data
2	{"a": "xoo", "b": [1, 2, 3], "c": 200}
update json_test set data = json_replace(json_replace(data, '$.a', 'boo'), '$.c', 100) where id = 2;
select * from json_test where id=2;
id	data
2	{"a": "boo", "b": [1, 2, 3], "c": 100}
set log_row_value_options="";
drop table json_test;
