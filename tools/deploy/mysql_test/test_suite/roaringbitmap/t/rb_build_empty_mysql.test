#owner: xuqijia.xqj
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Base test of rb_is_empty/rb_build_empty.
--echo # ----------------------------------------------------------------------


--disable_warnings
drop table if exists t1,t2,t3;
--enable_warnings
select hex(rb_build_empty());
--error 1582
select hex(rb_build_empty(1));
--error 1582
select hex(rb_build_empty('a'));
--error 1582
select rb_build_empty(rb_build_empty());
select rb_is_empty(rb_build_empty());
create table t1 (id int, rb roaringbitmap);
insert into t1 values(1, rb_build_empty());
select id, hex(rb) from t1;
select rb_is_empty(rb) from t1;
alter table t1 add column rb_gen roaringbitmap generated always as (rb_build_empty());
alter table t1 add column rb_gen_empty int generated always as (rb_is_empty(rb));
insert into t1(id, rb) values(2, x'010101000000');
select id, hex(rb), hex(rb_gen), rb_gen_empty from t1;
--error 1064 # not support currently
alter table t1 add column rb_def roaringbitmap default rb_build_empty();

create table t2 (id int, rb_gen roaringbitmap generated always as (rb_build_empty()));
insert into t2(id) values(1);
select id, hex(rb_gen) from t2;

--error 1064 # not support currently
create table t3 (id int, rb_def roaringbitmap default rb_build_empty());

select rb_is_empty(null);
--error 3064
select rb_is_empty('');
--error 4070
select rb_is_empty(x'');
--error 3064
select rb_is_empty('aa');
--error 3064
select rb_is_empty(2);

# bintype = EMPTY
select rb_is_empty(x'0100');
# bintype = SINGLE_32
select rb_is_empty(x'010101000000');
# bintype = SINGLE_64
select rb_is_empty(x'01020100000001000000');
# bintype = BITMAP_32
select rb_is_empty(x'01053A30000000000000');
# bintype = BITMAP_64
select rb_is_empty(x'01060000000000000000');
select rb_is_empty(x'01060100000000000000000000003a3000000100000000000000100000000100');
select rb_is_empty(x'01060200000000000000000000003a3000000100000000000000100000000100010000003a30000001000000000001001000000001000200');

# cleanup
--disable_warnings
drop table if exists t1,t2,t3;
--enable_warnings
