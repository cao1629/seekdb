#owner: xuqijia.xqj
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Base test of rb_cardinality.
--echo # ----------------------------------------------------------------------

--disable_warnings
drop table if exists t1,t2;
--enable_warnings

select rb_cardinality(null);
--error 3064
select rb_cardinality('');
--error 4070
select rb_cardinality(x'');
--error 3064
select rb_cardinality('aa');
--error 3064
select rb_cardinality(2);

# bintype = EMPTY
select rb_cardinality(x'0100');
# bintype = SINGLE_32
select rb_cardinality(x'010101000000');
# bintype = SINGLE_64
select rb_cardinality(x'01020100000001000000');
# bintype = SET_32
--error 4070
select rb_cardinality(x'01030101000000');
select rb_cardinality(x'0103020100000002000000');
# bintype = SET_64
--error 4070
select rb_cardinality(x'0104010100000001000000');
select rb_cardinality(x'01040201000000010000000100000002000000');
# bintype = BITMAP_32,
select rb_cardinality(x'01053A30000000000000');
select rb_cardinality(x'01053a3000000100000000000000100000000100');
select rb_cardinality(x'01053a30000001000000000001001000000001000200');
select rb_cardinality(x'01053a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
# bintype = BITMAP_64
select rb_cardinality(x'01060000000000000000');
select rb_cardinality(x'01060100000000000000000000003a3000000100000000000000100000000100');
select rb_cardinality(x'01060100000000000000010000003a3000000100000000000000100000000000');
select rb_cardinality(x'01060100000000000000000000003a30000001000000000001001000000001000200');
select rb_cardinality(x'01060200000000000000000000003a3000000100000000000000100000000100010000003a3000000100000000000000100000000000');
select rb_cardinality(x'01060100000000000000000000003a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
select rb_cardinality(x'01060200000000000000000000003a30000001000000ffff000010000000ffff010000003a3000000100000000001e001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e00');
select rb_cardinality(x'01062000000000000000000000003a3000000100000000000000100000000000010000003a3000000100000000000000100000000000020000003a3000000100000000000000100000000000030000003a3000000100000000000000100000000000040000003a3000000100000000000000100000000000050000003a3000000100000000000000100000000000060000003a3000000100000000000000100000000000070000003a3000000100000000000000100000000000080000003a3000000100000000000000100000000000090000003a30000001000000000000001000000000000a0000003a30000001000000000000001000000000000b0000003a30000001000000000000001000000000000c0000003a30000001000000000000001000000000000d0000003a30000001000000000000001000000000000e0000003a30000001000000000000001000000000000f0000003a3000000100000000000000100000000000100000003a3000000100000000000000100000000000110000003a3000000100000000000000100000000000120000003a3000000100000000000000100000000000130000003a3000000100000000000000100000000000140000003a3000000100000000000000100000000000150000003a3000000100000000000000100000000000160000003a3000000100000000000000100000000000170000003a3000000100000000000000100000000000180000003a3000000100000000000000100000000000190000003a30000001000000000000001000000000001a0000003a30000001000000000000001000000000001b0000003a30000001000000000000001000000000001c0000003a30000001000000000000001000000000001d0000003a30000001000000000000001000000000001e0000003a30000001000000000000001000000000001f0000003a3000000100000000000000100000000000');
select rb_cardinality(x'01060200000000000000000000003a300000020000000000010001000100180000001c0000000100020001000200010000003a300000020000000000010001000100180000001c0000000000010000000100');
create table t1(c int);
INSERT INTO t1 values(rb_cardinality(x'0100'));
select * from t1;

# bintype = BITMAP_32, 3B30 binary
select rb_cardinality(x'01053b300000010000e70301000000e703');
select rb_cardinality(x'01053b300000010000e90303000000e703d0070000d2070000');
select rb_cardinality(x'01053b300100030000e7030100e70301000000e70301000000e703');
select rb_cardinality(x'01053b300100010000e7030100010001000000e703d007d207');
select rb_cardinality(x'01053b3004001f0000e7030100e7030200e7030300e7030400e7032d00000033000000390000003f0000004500000001000000e70301000000e70301000000e70301000000e70301000000e703');
select rb_cardinality(x'01053b3004001e000000000100e7030200e7030300e7030400e7032d0000002f000000350000003b00000041000000010001000000e70301000000e70301000000e70301000000e703');

# bintype = BITMAP_64, 3B30 binary
select rb_cardinality(x'01060100000000000000000000003b300000010000e70301000000e703');
select rb_cardinality(x'01060100000000000000000000003b300000010000e90303000000e703d0070000d2070000');
select rb_cardinality(x'01060100000000000000000000003b300100030000e7030100e70301000000e70301000000e703');
select rb_cardinality(x'01060100000000000000000000003b300100010000e7030100010001000000e703d007d207');
select rb_cardinality(x'01060100000000000000000000003b3004001f0000e7030100e7030200e7030300e7030400e7032d00000033000000390000003f0000004500000001000000e70301000000e70301000000e70301000000e70301000000e703');
select rb_cardinality(x'01060100000000000000000000003b3004001e000000000100e7030200e7030300e7030400e7032d0000002f000000350000003b00000041000000010001000000e70301000000e70301000000e70301000000e703');
select rb_cardinality(x'01060200000000000000000000003b300000010000e70301000000e703010000003b300000010000e70301000000e703');
select rb_cardinality(x'01060200000000000000000000003b300000010000e90303000000e703d0070000d2070000020000003b300000010000e90303000000e703d0070000d2070000');
select rb_cardinality(x'01060200000000000000000000003b300100030000e7030100e70301000000e70301000000e703010000003b300100030000e7030100e70301000000e70301000000e703');
select rb_cardinality(x'01060200000000000000000000003b300100010000e7030100010001000000e703d007d207010000003b300100010000e7030100010001000000e703d007d207');
select rb_cardinality(x'01060200000000000000000000003b3004001f0000e7030100e7030200e7030300e7030400e7032d00000033000000390000003f0000004500000001000000e70301000000e70301000000e70301000000e70301000000e703010000003b3004001f0000e7030100e7030200e7030300e7030400e7032d00000033000000390000003f0000004500000001000000e70301000000e70301000000e70301000000e70301000000e703');
select rb_cardinality(x'01060200000000000000000000003b3004001e000000000100e7030200e7030300e7030400e7032d0000002f000000350000003b00000041000000010001000000e70301000000e70301000000e70301000000e703010000003b3004001e000000000100e7030200e7030300e7030400e7032d0000002f000000350000003b00000041000000010001000000e70301000000e70301000000e70301000000e703');

create table t2(rb roaringbitmap, c int generated always as (rb_cardinality(rb)));
INSERT INTO t2(rb) values(x'0100'), (x'010101000000');
select rb_to_string(rb), c from t2;

# cleanup
--disable_warnings
drop table if exists t1,t2;
--enable_warnings
