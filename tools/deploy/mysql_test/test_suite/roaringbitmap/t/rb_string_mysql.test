#owner: xuqijia.xqj
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Base test of roaringbitmap rb_to_string and rb_from_string.
--echo # ----------------------------------------------------------------------


--echo #
--echo # Setup test.
--echo #
--disable_warnings
drop table if exists t1, t2, t3, t4, t5;
drop table if exists tt1;
--enable_warnings

select rb_to_string(null);
--error 3064
select rb_to_string('');
--error 4070
select rb_to_string(x'');
--error 3064
select rb_to_string('aa');
--error 3064
select rb_to_string(2);

--echo test: rb_to_string from binary
# 00->EMPTY
select rb_to_string(x'0100');
--error 4070
select rb_to_string(x'0200');
# 01->SINGLE_32
select rb_to_string(x'010101000000');
select rb_to_string(x'0101FFFFFFFF');
--error 4070
select rb_to_string(x'01010100000000000000');
# 02->SINGLE_64
select rb_to_string(x'01020100000001000000');
select rb_to_string(x'0102FFFFFFFFFFFFFFFF');
--error 4070
select rb_to_string(x'010201000000');
# 03->SET_32
--error 4070
select rb_to_string(x'0103');
--error 4070
select rb_to_string(x'010300');
--error 4070
select rb_to_string(x'010301');
--error 4070
select rb_to_string(x'01030101000000');
--error 4070
select rb_to_string(x'010301FFFFFFFF');
select rb_to_string(x'0103020100000002000000');
--error 4070
select rb_to_string(x'0103010100000002000000');
# 04->SET_64
--error 4070
select rb_to_string(x'0104');
--error 4070
select rb_to_string(x'010400');
--error 4070
select rb_to_string(x'010401');
--error 4070
select rb_to_string(x'01040101000000');
--error 4070
select rb_to_string(x'0104010100000000000000');
--error 4070
select rb_to_string(x'0104010100000001000000');
--error 4070
select rb_to_string(x'010401FFFFFFFFFFFFFFFF');
select rb_to_string(x'01040201000000000000000200000000000000');
select rb_to_string(x'01040201000000010000000100000002000000');
# 05->BITMAP_32
--error 4070
select rb_to_string(x'0105');
select rb_to_string(x'01053a30000000000000');
select rb_to_string(x'01053a3000000100000000000000100000000100');
select rb_to_string(x'01053a30000001000000000001001000000001000200');
select rb_to_string(x'01053a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
select rb_to_string(x'01053a3000000200000000000000ffff0000180000001a0000000000ffff');
# 06->BITMAP_64
--error 4070
select rb_to_string(x'0106');
select rb_to_string(x'01060000000000000000');
select rb_to_string(x'01060100000000000000000000003a3000000100000000000000100000000100');
select rb_to_string(x'01060100000000000000010000003a3000000100000000000000100000000000');
select rb_to_string(x'01060100000000000000000000003a30000001000000000001001000000001000200');
select rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000100010000003a3000000100000000000000100000000000');
select rb_to_string(x'01060100000000000000000000003a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
select rb_to_string(x'01060200000000000000000000003a30000001000000ffff000010000000ffff010000003a3000000100000000001e001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e00');
select rb_to_string(x'01062000000000000000000000003a3000000100000000000000100000000000010000003a3000000100000000000000100000000000020000003a3000000100000000000000100000000000030000003a3000000100000000000000100000000000040000003a3000000100000000000000100000000000050000003a3000000100000000000000100000000000060000003a3000000100000000000000100000000000070000003a3000000100000000000000100000000000080000003a3000000100000000000000100000000000090000003a30000001000000000000001000000000000a0000003a30000001000000000000001000000000000b0000003a30000001000000000000001000000000000c0000003a30000001000000000000001000000000000d0000003a30000001000000000000001000000000000e0000003a30000001000000000000001000000000000f0000003a3000000100000000000000100000000000100000003a3000000100000000000000100000000000110000003a3000000100000000000000100000000000120000003a3000000100000000000000100000000000130000003a3000000100000000000000100000000000140000003a3000000100000000000000100000000000150000003a3000000100000000000000100000000000160000003a3000000100000000000000100000000000170000003a3000000100000000000000100000000000180000003a3000000100000000000000100000000000190000003a30000001000000000000001000000000001a0000003a30000001000000000000001000000000001b0000003a30000001000000000000001000000000001c0000003a30000001000000000000001000000000001d0000003a30000001000000000000001000000000001e0000003a30000001000000000000001000000000001f0000003a3000000100000000000000100000000000');
select rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000000ffffffff3a30000001000000ffff000010000000ffff');

--echo test: rb_from_string value range
select rb_to_string(rb_from_string('0'));
select rb_to_string(rb_from_string('1'));
select rb_to_string(rb_from_string('-1'));
select rb_to_string(rb_from_string('18446744073709551615'));
--error 4019
select rb_to_string(rb_from_string('18446744073709551616'));
--error 4019
select rb_to_string(rb_from_string('-2147483649'));
select rb_to_string(rb_from_string('-2147483648'));
select rb_to_string(rb_from_string('9223372036854775806'));
select rb_to_string(rb_from_string('9223372036854775807'));
select rb_to_string(rb_from_string('9223372036854775808'));
--error 4019
select rb_to_string(rb_from_string('-18446744073709551615'));

--echo test: rb_from_string string format

select rb_from_string(null);
--error 3064
select rb_from_string(x'');
--error 3064
select rb_from_string(2);

select rb_to_string(rb_from_string(''));
select rb_to_string(rb_from_string(' '));
--error 4070
select rb_to_string(rb_from_string(' , '));
--error 4070
select rb_to_string(rb_from_string(' , , '));
--error 4070
select rb_to_string(rb_from_string(',1'));
select rb_to_string(rb_from_string(' 0 '));
--error 4070
select rb_to_string(rb_from_string(' 1, '));
select rb_to_string(rb_from_string(' 1 , 2, 4'));
--error 4070
select rb_to_string(rb_from_string(' 1 , 2, , 4'));
--error 4070
select rb_to_string(rb_from_string(' - 1 '));
--error 4070
select rb_to_string(rb_from_string(' --1 '));
select rb_to_string(rb_from_string(' +1 '));
--error 4070
select rb_to_string(rb_from_string(' ++1 '));
select rb_to_string(rb_from_string('12,-1'));
--error 4070
select rb_to_string(rb_from_string('  a '));
--error 4070
select rb_to_string(rb_from_string('11,a'));
--error 4070
select rb_to_string(rb_from_string('1, 2, 3 a'));
--error 4070
select rb_to_string(rb_from_string('{1,2,3}'));

# bugfix: 57437875
select hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,32'));
select hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33'));

# bugfix: 57465565
--error 4070
select rb_to_string(rb_build_varbinary(x'01060000000001000000'));
--error 4070
select rb_to_string(rb_build_varbinary(x'01050000000001000000'));
--error 4070
select rb_to_string(x'01060000000001000000');
--error 4070
select rb_to_string(x'01050000000001000000');
--error 4070
select rb_to_string(x'010601000000');
--error 4070
select rb_to_string(x'010501000000');

# bugfix: 57444564
--disable_warnings
drop table if exists tt2;
--enable_warnings
create table tt2(id int,a0 blob);
insert into tt2 values(0,null);
insert into tt2 values(1,'1');
insert into tt2 values(2,'4294967296');
insert into tt2 values(3,'1,2,6,4,5,9');
insert into tt2 values(3,'1,2,6,4,5,9');
insert into tt2 values(4,'4294967296,4294967297,4294967298,4294967299');
insert into tt2 values(5,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33');
insert into tt2 values(5,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65537,65536');
insert into tt2 values(6,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,4294967298,65536');
insert into tt2 values(6,'4294967296,4294967297,42949672969,4294967298,42949672961,42949672962,4294967299,4294967297,14294967296,14294967696,14295967296,5294967296,7294967296,9294967296,8294967296,42949617296,42949672916,4294967396,4294967496,4294967595,4294967696,4294967795,4294968295,4294967995,4294977295,4294987295,4294997295,4294968295,4294969295,4295967295,4296967295,4297967295,4298967295');

select rb_to_string(rb_from_string(a0)), hex(rb_from_string(a0)) from tt2;

# bugfix: 57443470
create table tt1(id int ,b binary(2));
insert into tt1 values(1,'1');
select hex(rb_from_string(b)) from tt1;

# cleanup
--disable_warnings
drop table if exists t1, t2, t3, t4, t5;
drop table if exists tt1;
--enable_warnings
