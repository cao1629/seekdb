# ----------------------------------------------------------------------
# Base test of roaringbitmap rb_to_string and rb_from_string.
# ----------------------------------------------------------------------
#
# Setup test.
#
drop table if exists t1, t2, t3, t4, t5;
drop table if exists tt1;
select rb_to_string(null);
rb_to_string(null)
NULL
select rb_to_string('');
ERROR HY000: invalid type given for an argument
select rb_to_string(x'');
ERROR HY000: Invalid data
select rb_to_string('aa');
ERROR HY000: invalid type given for an argument
select rb_to_string(2);
ERROR HY000: invalid type given for an argument
test: rb_to_string from binary
select rb_to_string(x'0100');
rb_to_string(x'0100')

select rb_to_string(x'0200');
ERROR HY000: Invalid data
select rb_to_string(x'010101000000');
rb_to_string(x'010101000000')
1
select rb_to_string(x'0101FFFFFFFF');
rb_to_string(x'0101FFFFFFFF')
4294967295
select rb_to_string(x'01010100000000000000');
ERROR HY000: Invalid data
select rb_to_string(x'01020100000001000000');
rb_to_string(x'01020100000001000000')
4294967297
select rb_to_string(x'0102FFFFFFFFFFFFFFFF');
rb_to_string(x'0102FFFFFFFFFFFFFFFF')
18446744073709551615
select rb_to_string(x'010201000000');
ERROR HY000: Invalid data
select rb_to_string(x'0103');
ERROR HY000: Invalid data
select rb_to_string(x'010300');
ERROR HY000: Invalid data
select rb_to_string(x'010301');
ERROR HY000: Invalid data
select rb_to_string(x'01030101000000');
ERROR HY000: Invalid data
select rb_to_string(x'010301FFFFFFFF');
ERROR HY000: Invalid data
select rb_to_string(x'0103020100000002000000');
rb_to_string(x'0103020100000002000000')
1,2
select rb_to_string(x'0103010100000002000000');
ERROR HY000: Invalid data
select rb_to_string(x'0104');
ERROR HY000: Invalid data
select rb_to_string(x'010400');
ERROR HY000: Invalid data
select rb_to_string(x'010401');
ERROR HY000: Invalid data
select rb_to_string(x'01040101000000');
ERROR HY000: Invalid data
select rb_to_string(x'0104010100000000000000');
ERROR HY000: Invalid data
select rb_to_string(x'0104010100000001000000');
ERROR HY000: Invalid data
select rb_to_string(x'010401FFFFFFFFFFFFFFFF');
ERROR HY000: Invalid data
select rb_to_string(x'01040201000000000000000200000000000000');
rb_to_string(x'01040201000000000000000200000000000000')
1,2
select rb_to_string(x'01040201000000010000000100000002000000');
rb_to_string(x'01040201000000010000000100000002000000')
4294967297,8589934593
select rb_to_string(x'0105');
ERROR HY000: Invalid data
select rb_to_string(x'01053a30000000000000');
rb_to_string(x'01053a30000000000000')

select rb_to_string(x'01053a3000000100000000000000100000000100');
rb_to_string(x'01053a3000000100000000000000100000000100')
1
select rb_to_string(x'01053a30000001000000000001001000000001000200');
rb_to_string(x'01053a30000001000000000001001000000001000200')
1,2
select rb_to_string(x'01053a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
rb_to_string(x'01053a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00')
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31
select rb_to_string(x'01053a3000000200000000000000ffff0000180000001a0000000000ffff');
rb_to_string(x'01053a3000000200000000000000ffff0000180000001a0000000000ffff')
0,4294967295
select rb_to_string(x'0106');
ERROR HY000: Invalid data
select rb_to_string(x'01060000000000000000');
rb_to_string(x'01060000000000000000')

select rb_to_string(x'01060100000000000000000000003a3000000100000000000000100000000100');
rb_to_string(x'01060100000000000000000000003a3000000100000000000000100000000100')
1
select rb_to_string(x'01060100000000000000010000003a3000000100000000000000100000000000');
rb_to_string(x'01060100000000000000010000003a3000000100000000000000100000000000')
4294967296
select rb_to_string(x'01060100000000000000000000003a30000001000000000001001000000001000200');
rb_to_string(x'01060100000000000000000000003a30000001000000000001001000000001000200')
1,2
select rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000100010000003a3000000100000000000000100000000000');
rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000100010000003a3000000100000000000000100000000000')
1,4294967296
select rb_to_string(x'01060100000000000000000000003a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00');
rb_to_string(x'01060100000000000000000000003a3000000100000000001f001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e001f00')
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31
select rb_to_string(x'01060200000000000000000000003a30000001000000ffff000010000000ffff010000003a3000000100000000001e001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e00');
rb_to_string(x'01060200000000000000000000003a30000001000000ffff000010000000ffff010000003a3000000100000000001e001000000000000100020003000400050006000700080009000a000b000c000d000e000f0010001100120013001400150016001700180019001a001b001c001d001e00')
4294967295,4294967296,4294967297,4294967298,4294967299,4294967300,4294967301,4294967302,4294967303,4294967304,4294967305,4294967306,4294967307,4294967308,4294967309,4294967310,4294967311,4294967312,4294967313,4294967314,4294967315,4294967316,4294967317,4294967318,4294967319,4294967320,4294967321,4294967322,4294967323,4294967324,4294967325,4294967326
select rb_to_string(x'01062000000000000000000000003a3000000100000000000000100000000000010000003a3000000100000000000000100000000000020000003a3000000100000000000000100000000000030000003a3000000100000000000000100000000000040000003a3000000100000000000000100000000000050000003a3000000100000000000000100000000000060000003a3000000100000000000000100000000000070000003a3000000100000000000000100000000000080000003a3000000100000000000000100000000000090000003a30000001000000000000001000000000000a0000003a30000001000000000000001000000000000b0000003a30000001000000000000001000000000000c0000003a30000001000000000000001000000000000d0000003a30000001000000000000001000000000000e0000003a30000001000000000000001000000000000f0000003a3000000100000000000000100000000000100000003a3000000100000000000000100000000000110000003a3000000100000000000000100000000000120000003a3000000100000000000000100000000000130000003a3000000100000000000000100000000000140000003a3000000100000000000000100000000000150000003a3000000100000000000000100000000000160000003a3000000100000000000000100000000000170000003a3000000100000000000000100000000000180000003a3000000100000000000000100000000000190000003a30000001000000000000001000000000001a0000003a30000001000000000000001000000000001b0000003a30000001000000000000001000000000001c0000003a30000001000000000000001000000000001d0000003a30000001000000000000001000000000001e0000003a30000001000000000000001000000000001f0000003a3000000100000000000000100000000000');
rb_to_string(x'01062000000000000000000000003a3000000100000000000000100000000000010000003a3000000100000000000000100000000000020000003a3000000100000000000000100000000000030000003a3000000100000000000000100000000000040000003a3000000100000000000000100000000000
0,4294967296,8589934592,12884901888,17179869184,21474836480,25769803776,30064771072,34359738368,38654705664,42949672960,47244640256,51539607552,55834574848,60129542144,64424509440,68719476736,73014444032,77309411328,81604378624,85899345920,90194313216,94489280512,98784247808,103079215104,107374182400,111669149696,115964116992,120259084288,124554051584,128849018880,133143986176
select rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000000ffffffff3a30000001000000ffff000010000000ffff');
rb_to_string(x'01060200000000000000000000003a3000000100000000000000100000000000ffffffff3a30000001000000ffff000010000000ffff')
0,18446744073709551615
test: rb_from_string value range
select rb_to_string(rb_from_string('0'));
rb_to_string(rb_from_string('0'))
0
select rb_to_string(rb_from_string('1'));
rb_to_string(rb_from_string('1'))
1
select rb_to_string(rb_from_string('-1'));
rb_to_string(rb_from_string('-1'))
4294967295
select rb_to_string(rb_from_string('18446744073709551615'));
rb_to_string(rb_from_string('18446744073709551615'))
18446744073709551615
select rb_to_string(rb_from_string('18446744073709551616'));
ERROR HY000: Size overflow
select rb_to_string(rb_from_string('-2147483649'));
ERROR HY000: Size overflow
select rb_to_string(rb_from_string('-2147483648'));
rb_to_string(rb_from_string('-2147483648'))
2147483648
select rb_to_string(rb_from_string('9223372036854775806'));
rb_to_string(rb_from_string('9223372036854775806'))
9223372036854775806
select rb_to_string(rb_from_string('9223372036854775807'));
rb_to_string(rb_from_string('9223372036854775807'))
9223372036854775807
select rb_to_string(rb_from_string('9223372036854775808'));
rb_to_string(rb_from_string('9223372036854775808'))
9223372036854775808
select rb_to_string(rb_from_string('-18446744073709551615'));
ERROR HY000: Size overflow
test: rb_from_string string format
select rb_from_string(null);
rb_from_string(null)
NULL
select rb_from_string(x'');
ERROR HY000: invalid type given for an argument
select rb_from_string(2);
ERROR HY000: invalid type given for an argument
select rb_to_string(rb_from_string(''));
rb_to_string(rb_from_string(''))

select rb_to_string(rb_from_string(' '));
rb_to_string(rb_from_string(' '))

select rb_to_string(rb_from_string(' , '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' , , '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(',1'));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' 0 '));
rb_to_string(rb_from_string(' 0 '))
0
select rb_to_string(rb_from_string(' 1, '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' 1 , 2, 4'));
rb_to_string(rb_from_string(' 1 , 2, 4'))
1,2,4
select rb_to_string(rb_from_string(' 1 , 2, , 4'));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' - 1 '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' --1 '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string(' +1 '));
rb_to_string(rb_from_string(' +1 '))
1
select rb_to_string(rb_from_string(' ++1 '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string('12,-1'));
rb_to_string(rb_from_string('12,-1'))
12,4294967295
select rb_to_string(rb_from_string('  a '));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string('11,a'));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string('1, 2, 3 a'));
ERROR HY000: Invalid data
select rb_to_string(rb_from_string('{1,2,3}'));
ERROR HY000: Invalid data
select hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,32'));
hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,32'))
0103200100000002000000030000000400000005000000060000000700000008000000090000000A0000000B0000000C0000000D0000000E0000000F000000100000001100000012000000130000001400000015000000160000001700000018000000190000001A0000001B0000001C0000001D0000001E0000001F00000020000000
select hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33'));
hex(rb_from_string('1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33'))
01060100000000000000000000003A3000000100000000002000100000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100
select rb_to_string(rb_build_varbinary(x'01060000000001000000'));
ERROR HY000: Invalid data
select rb_to_string(rb_build_varbinary(x'01050000000001000000'));
ERROR HY000: Invalid data
select rb_to_string(x'01060000000001000000');
ERROR HY000: Invalid data
select rb_to_string(x'01050000000001000000');
ERROR HY000: Invalid data
select rb_to_string(x'010601000000');
ERROR HY000: Invalid data
select rb_to_string(x'010501000000');
ERROR HY000: Invalid data
drop table if exists tt2;
create table tt2(id int,a0 blob);
insert into tt2 values(0,null);
insert into tt2 values(1,'1');
insert into tt2 values(2,'4294967296');
insert into tt2 values(3,'1,2,6,4,5,9');
insert into tt2 values(3,'1,2,6,4,5,9');
insert into tt2 values(4,'4294967296,4294967297,4294967298,4294967299');
insert into tt2 values(5,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33');
insert into tt2 values(5,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65537,65536');
insert into tt2 values(6,'1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,4294967298,65536');
insert into tt2 values(6,'4294967296,4294967297,42949672969,4294967298,42949672961,42949672962,4294967299,4294967297,14294967296,14294967696,14295967296,5294967296,7294967296,9294967296,8294967296,42949617296,42949672916,4294967396,4294967496,4294967595,4294967696,4294967795,4294968295,4294967995,4294977295,4294987295,4294997295,4294968295,4294969295,4295967295,4296967295,4297967295,4298967295');
select rb_to_string(rb_from_string(a0)), hex(rb_from_string(a0)) from tt2;
rb_to_string(rb_from_string(a0))	hex(rb_from_string(a0))
NULL	NULL
1	010101000000
4294967296	01020000000001000000
1,2,4,5,6,9	010306010000000200000004000000050000000600000009000000
1,2,4,5,6,9	010306010000000200000004000000050000000600000009000000
4294967296,4294967297,4294967298,4294967299	0104040000000001000000010000000100000002000000010000000300000001000000
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33	01060100000000000000000000003A3000000100000000002000100000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65536,65537	01060100000000000000000000003A3000000200000000001E000100010018000000560000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0000000100
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65536,4294967298	01060200000000000000000000003A3000000200000000001E000100000018000000560000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F000000010000003A3000000100000000000000100000000200
4294967296,4294967297,4294967298,4294967299,4294967396,4294967496,4294967595,4294967696,4294967795,4294967995,4294968295,4294969295,4294977295,4294987295,4294997295,4295967295,4296967295,4297967295,4298967295,5294967296,7294967296,8294967296,9294967296,14294967296,14294967696,14295967296,42949617296,42949672916,42949672961,42949672962,42949672969	01041F00000000010000000100000001000000020000000100000003000000010000006400000001000000C8000000010000002B010000010000009001000001000000F301000001000000BB02000001000000E703000001000000CF070000010000000F270000010000001F4E0000010000002F750000010000003F420F00010000007F841E0001000000BFC62D0001000000FF083D000100000000CA9A3B01000000005ED0B20100000000286BEE0100000000F2052A0200000000E40B540300000090E50B540300000040261B54030000009026FFFF09000000D4FFFFFF09000000010000000A000000020000000A000000090000000A000000
create table tt1(id int ,b binary(2));
insert into tt1 values(1,'1');
select hex(rb_from_string(b)) from tt1;
hex(rb_from_string(b))
010101000000
drop table if exists t1, t2, t3, t4, t5;
drop table if exists tt1;
