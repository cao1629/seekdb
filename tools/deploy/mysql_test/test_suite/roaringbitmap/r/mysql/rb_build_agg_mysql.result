# ----------------------------------------------------------------------
# Base test of roaringbitmap rb_build_agg.
# ----------------------------------------------------------------------
#
# Setup test.
#
drop table if exists t1, t2, t3, t4, t5;
CREATE TABLE t1 (id int, k int, val bigint);
INSERT INTO t1 VALUES
(1, 1, NULL),
(2, 1, 1),
(3, 2, 4294967295 + 2),
(4, 2, 3),
(5, 3, 4),
(6, 3, 5),
(7, 3, 6),
(8, 4, 1),
(9, 4, 4294967295 + 2),
(10, 5, 4294967295 + 3),
(11, 5, 4294967295 + 4),
(12, 5, 4294967295 + 5);
SELECT k, RB_TO_STRING(RB_BUILD_AGG(val)), hex(RB_BUILD_AGG(val)) FROM t1 GROUP BY k;
k	RB_TO_STRING(RB_BUILD_AGG(val))	hex(RB_BUILD_AGG(val))
1	1	010101000000
2	3,4294967297	01040203000000000000000100000001000000
3	4,5,6	010303040000000500000006000000
4	1,4294967297	01040201000000000000000100000001000000
5	4294967298,4294967299,4294967300	010403020000000100000003000000010000000400000001000000
SELECT RB_TO_STRING(RB_BUILD_AGG(val)), hex(RB_BUILD_AGG(val)) FROM t1 ;
RB_TO_STRING(RB_BUILD_AGG(val))	hex(RB_BUILD_AGG(val))
1,3,4,5,6,4294967297,4294967298,4294967299,4294967300	010409010000000000000003000000000000000400000000000000050000000000000006000000000000000100000001000000020000000100000003000000010000000400000001000000
CREATE TABLE t2 (val bigint);
insert into t2 values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19),(20),(21),(22),(23),(24),(25),(26),(27),(28),(29),(30),(31),(32);
SELECT RB_TO_STRING(RB_BUILD_AGG(val)), hex(RB_BUILD_AGG(val)) FROM t2;
RB_TO_STRING(RB_BUILD_AGG(val))	hex(RB_BUILD_AGG(val))
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32	01060100000000000000000000003A30000001000000000020001000000000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F002000
insert into t2 values (4294967295 + 1);
SELECT RB_TO_STRING(RB_BUILD_AGG(val)), hex(RB_BUILD_AGG(val)) FROM t2;
RB_TO_STRING(RB_BUILD_AGG(val))	hex(RB_BUILD_AGG(val))
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,4294967296	01060200000000000000000000003A30000001000000000020001000000000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F002000010000003A3000000100000000000000100000000000
CREATE TABLE t3 (id int, k int, val int);
INSERT INTO t3 VALUES
(1, 1, NULL),
(2, 1, 1),
(3, 2, 2),
(4, 3, 3),
(5, 3, 4),
(6, 3, 5),
(7, 4, NULL);
SELECT k, RB_TO_STRING(RB_BUILD_AGG(val)), hex(RB_BUILD_AGG(val)) FROM t3 GROUP BY k;
k	RB_TO_STRING(RB_BUILD_AGG(val))	hex(RB_BUILD_AGG(val))
1	1	010101000000
2	2	010102000000
3	3,4,5	010303030000000400000005000000
4	NULL	NULL
CREATE TABLE t4 (id int, var_float float, var_double double, var_varchar varchar(10));
insert into t4 values(1, NULL, NULL, NULL);
SELECT RB_BUILD_AGG(var_float) FROM t4;
ERROR HY000: invalid type given for an argument
SELECT RB_BUILD_AGG(var_double) FROM t4;
ERROR HY000: invalid type given for an argument
SELECT RB_BUILD_AGG(var_varchar) FROM t4;
ERROR HY000: invalid type given for an argument
insert into t4 values(2, 1, 1, '1');
SELECT RB_BUILD_AGG(var_float) FROM t4;
ERROR HY000: invalid type given for an argument
SELECT RB_BUILD_AGG(var_double) FROM t4;
ERROR HY000: invalid type given for an argument
SELECT RB_BUILD_AGG(var_varchar) FROM t4;
ERROR HY000: invalid type given for an argument
CREATE TABLE t5 (var_bool bool, var_tinyint tinyint, var_smallint smallint, var_mediumint mediumint, var_integer integer, var_bigint bigint);
insert into t5 values(1, 127, 32767, 8388607, 2147483647, 9223372036854775807);
SELECT RB_TO_STRING(RB_BUILD_AGG(var_bool)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_bool))
1
SELECT RB_TO_STRING(RB_BUILD_AGG(var_tinyint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_tinyint))
127
SELECT RB_TO_STRING(RB_BUILD_AGG(var_smallint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_smallint))
32767
SELECT RB_TO_STRING(RB_BUILD_AGG(var_mediumint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_mediumint))
8388607
SELECT RB_TO_STRING(RB_BUILD_AGG(var_integer)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_integer))
2147483647
SELECT RB_TO_STRING(RB_BUILD_AGG(var_bigint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_bigint))
9223372036854775807
insert into t5 values(0, -128, -32768, -8388608, -2147483648, -9223372036854775808);
SELECT RB_TO_STRING(RB_BUILD_AGG(var_bool)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_bool))
0,1
SELECT RB_TO_STRING(RB_BUILD_AGG(var_tinyint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_tinyint))
127,4294967168
SELECT RB_TO_STRING(RB_BUILD_AGG(var_smallint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_smallint))
32767,4294934528
SELECT RB_TO_STRING(RB_BUILD_AGG(var_mediumint)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_mediumint))
8388607,4286578688
SELECT RB_TO_STRING(RB_BUILD_AGG(var_integer)) FROM t5;
RB_TO_STRING(RB_BUILD_AGG(var_integer))
2147483647,2147483648
SELECT RB_TO_STRING(RB_BUILD_AGG(var_bigint)) FROM t5;
ERROR HY000: Size overflow
select rb_to_string(RB_BUILD_AGG(-1));
rb_to_string(RB_BUILD_AGG(-1))
4294967295
select rb_to_string(RB_BUILD_AGG(-2147483648));
rb_to_string(RB_BUILD_AGG(-2147483648))
2147483648
select rb_to_string(RB_BUILD_AGG(-2147483649));
ERROR HY000: Size overflow
select rb_to_string(RB_BUILD_AGG(-9223372036854775808));
ERROR HY000: Size overflow
select rb_to_string(RB_BUILD_AGG(2147483647));
rb_to_string(RB_BUILD_AGG(2147483647))
2147483647
select rb_to_string(RB_BUILD_AGG(2147483648));
rb_to_string(RB_BUILD_AGG(2147483648))
2147483648
select rb_to_string(RB_BUILD_AGG(18446744073709551615));
rb_to_string(RB_BUILD_AGG(18446744073709551615))
18446744073709551615
select rb_to_string(RB_BUILD_AGG(18446744073709551616));
ERROR HY000: invalid type given for an argument
select hex(RB_BUILD_AGG(NULL));
hex(RB_BUILD_AGG(NULL))
NULL
select hex(RB_BUILD_AGG(1));
hex(RB_BUILD_AGG(1))
010101000000
select hex(RB_BUILD_AGG(-1));
hex(RB_BUILD_AGG(-1))
0101FFFFFFFF
SELECT RB_BUILD_AGG((SELECT 1, 1));
ERROR 21000: Operand should contain 1 column(s)
drop table if exists t1, t2, t3, t4, t5;
create table t1(id bigint primary key, c1 bigint) partition by key(id) partitions 8;
insert into t1 select abs(random(0)), (abs(random(1))%500+455876444690) from table(generator(1000));
select count(c1) from t1;
count(c1)
1000
select count(distinct c1)from t1;
count(distinct c1)
424
explain basic select RB_CARDINALITY(rb_build_agg(c1)) from t1;
Query Plan
===========================================
|ID|OPERATOR                     |NAME    |
-------------------------------------------
|0 |SCALAR GROUP BY              |        |
|1 |└─PX COORDINATOR             |        |
|2 |  └─EXCHANGE OUT DISTR       |:EX10000|
|3 |    └─MERGE GROUP BY         |        |
|4 |      └─PX PARTITION ITERATOR|        |
|5 |        └─TABLE FULL SCAN    |t1      |
===========================================
Outputs & filters:
-------------------------------------
  0 - output([RB_CARDINALITY(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))))]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1)))])
  1 - output([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
  2 - output([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
      dop=1
  3 - output([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))])
  4 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      force partition granule
  5 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      access([t1.c1]), partitions(p[0-7])
      is_index_back=false, is_global_index=false,
      range_key([t1.id]), range(MIN ; MAX)always true,
      pushdown_aggregation([T_FUN_SYS_RB_BUILD_AGG(t1.c1)])
select RB_CARDINALITY(rb_build_agg(c1)) from t1;
RB_CARDINALITY(rb_build_agg(c1))
424
explain basic select /*+ NO_GBY_PUSHDOWN */ RB_CARDINALITY(rb_build_agg(c1)) from t1;
Query Plan
=========================================
|ID|OPERATOR                   |NAME    |
-----------------------------------------
|0 |SCALAR GROUP BY            |        |
|1 |└─PX COORDINATOR           |        |
|2 |  └─EXCHANGE OUT DISTR     |:EX10000|
|3 |    └─PX PARTITION ITERATOR|        |
|4 |      └─TABLE FULL SCAN    |t1      |
=========================================
Outputs & filters:
-------------------------------------
  0 - output([RB_CARDINALITY(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1)))]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))])
  1 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
  2 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      dop=1
  3 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      force partition granule
  4 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      access([t1.c1]), partitions(p[0-7])
      is_index_back=false, is_global_index=false,
      range_key([t1.id]), range(MIN ; MAX)always true,
      pushdown_aggregation([T_FUN_SYS_RB_BUILD_AGG(t1.c1)])
select /*+ NO_GBY_PUSHDOWN */ RB_CARDINALITY(rb_build_agg(c1)) from t1;
RB_CARDINALITY(rb_build_agg(c1))
424
explain basic select /*+ opt_param('pushdown_storage_level', 0) */  RB_CARDINALITY(rb_build_agg(c1)) from t1;
Query Plan
===========================================
|ID|OPERATOR                     |NAME    |
-------------------------------------------
|0 |SCALAR GROUP BY              |        |
|1 |└─PX COORDINATOR             |        |
|2 |  └─EXCHANGE OUT DISTR       |:EX10000|
|3 |    └─MERGE GROUP BY         |        |
|4 |      └─PX PARTITION ITERATOR|        |
|5 |        └─TABLE FULL SCAN    |t1      |
===========================================
Outputs & filters:
-------------------------------------
  0 - output([RB_CARDINALITY(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1)))]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))])
  1 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
  2 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      dop=1
  3 - output([T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_SYS_RB_BUILD_AGG(t1.c1)])
  4 - output([t1.c1]), filter(nil), rowset=256
      force partition granule
  5 - output([t1.c1]), filter(nil), rowset=256
      access([t1.c1]), partitions(p[0-7])
      is_index_back=false, is_global_index=false,
      range_key([t1.id]), range(MIN ; MAX)always true
select /*+ opt_param('pushdown_storage_level', 0) */  RB_CARDINALITY(rb_build_agg(c1)) from t1;
RB_CARDINALITY(rb_build_agg(c1))
424
select /*+ opt_param('enable_rich_vector_format', 'false') */  RB_CARDINALITY(rb_build_agg(c1)) from t1;
RB_CARDINALITY(rb_build_agg(c1))
424
explain basic select /*+ NO_GBY_PUSHDOWN opt_param('pushdown_storage_level', 0) */  count(distinct c1) from t1;
Query Plan
===================================================
|ID|OPERATOR                             |NAME    |
---------------------------------------------------
|0 |SCALAR GROUP BY                      |        |
|1 |└─PX COORDINATOR                     |        |
|2 |  └─EXCHANGE OUT DISTR               |:EX10001|
|3 |    └─SUBPLAN SCAN                   |VIEW1   |
|4 |      └─HASH DISTINCT                |        |
|5 |        └─EXCHANGE IN DISTR          |        |
|6 |          └─EXCHANGE OUT DISTR (HASH)|:EX10000|
|7 |            └─HASH DISTINCT          |        |
|8 |              └─PX PARTITION ITERATOR|        |
|9 |                └─TABLE FULL SCAN    |t1      |
===================================================
Outputs & filters:
-------------------------------------
  0 - output([T_FUN_COUNT(VIEW1.t1.c1)]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_COUNT(VIEW1.t1.c1)])
  1 - output([VIEW1.t1.c1]), filter(nil), rowset=256
  2 - output([VIEW1.t1.c1]), filter(nil), rowset=256
      dop=1
  3 - output([VIEW1.t1.c1]), filter(nil), rowset=256
      access([VIEW1.t1.c1])
  4 - output([t1.c1]), filter(nil), rowset=256
      distinct([t1.c1])
  5 - output([t1.c1]), filter(nil), rowset=256
  6 - output([t1.c1]), filter(nil), rowset=256
      (#keys=1, [t1.c1]), dop=1
  7 - output([t1.c1]), filter(nil), rowset=256
      distinct([t1.c1])
  8 - output([t1.c1]), filter(nil), rowset=256
      force partition granule
  9 - output([t1.c1]), filter(nil), rowset=256
      access([t1.c1]), partitions(p[0-7])
      is_index_back=false, is_global_index=false,
      range_key([t1.id]), range(MIN ; MAX)always true
select /*+ NO_GBY_PUSHDOWN opt_param('pushdown_storage_level', 0) */  count(distinct c1) from t1;
count(distinct c1)
424
explain basic select RB_CARDINALITY(rb_build_agg(c1)),  count(distinct c1)from t1;
Query Plan
=================================================
|ID|OPERATOR                           |NAME    |
-------------------------------------------------
|0 |SCALAR GROUP BY                    |        |
|1 |└─PX COORDINATOR                   |        |
|2 |  └─EXCHANGE OUT DISTR             |:EX10001|
|3 |    └─HASH GROUP BY                |        |
|4 |      └─EXCHANGE IN DISTR          |        |
|5 |        └─EXCHANGE OUT DISTR (HASH)|:EX10000|
|6 |          └─HASH GROUP BY          |        |
|7 |            └─PX PARTITION ITERATOR|        |
|8 |              └─TABLE FULL SCAN    |t1      |
=================================================
Outputs & filters:
-------------------------------------
  0 - output([RB_CARDINALITY(T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1)))], [T_FUN_COUNT_SUM(T_FUN_COUNT(dup(t1.c1)))]), filter(nil), rowset=256
      group(nil), agg_func([T_FUN_COUNT_SUM(T_FUN_COUNT(dup(t1.c1)))])
  1 - output([AGGR_CODE], [T_FUN_COUNT(dup(t1.c1))], [T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
  2 - output([AGGR_CODE], [T_FUN_COUNT(dup(t1.c1))], [T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
      dop=1
  3 - output([AGGR_CODE], [T_FUN_COUNT(dup(t1.c1))], [T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))]), filter(nil), rowset=256
      group([AGGR_CODE]), agg_func([T_FUN_COUNT(dup(t1.c1))], [T_FUN_SYS_RB_OR_AGG(T_FUN_SYS_RB_BUILD_AGG(t1.c1))])
  4 - output([AGGR_CODE], [dup(t1.c1)], [T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
  5 - output([AGGR_CODE], [dup(t1.c1)], [T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      (#keys=2, [AGGR_CODE], [dup(t1.c1)]), dop=1
  6 - output([AGGR_CODE], [dup(t1.c1)], [T_FUN_SYS_RB_BUILD_AGG(t1.c1)]), filter(nil), rowset=256
      group([AGGR_CODE], [dup(t1.c1)]), agg_func([T_FUN_SYS_RB_BUILD_AGG(t1.c1)])
  7 - output([t1.c1]), filter(nil), rowset=256
      force partition granule
  8 - output([t1.c1]), filter(nil), rowset=256
      access([t1.c1]), partitions(p[0-7])
      is_index_back=false, is_global_index=false,
      range_key([t1.id]), range(MIN ; MAX)always true
select RB_CARDINALITY(rb_build_agg(c1)),  count(distinct c1)from t1;
RB_CARDINALITY(rb_build_agg(c1))	count(distinct c1)
424	424
drop table if exists t1;
create table t1(id bigint primary key, c1 bigint, c2 bigint, c3 bigint) partition by key(id) partitions 8 with column group (all columns, each column);
insert into t1 select abs(random(0)), (abs(random(1))%50000000+455876444690), (abs(random(1))%20+455876444690), abs(random(1)%50000000) from table(generator(1000));
select /*+ NO_USE_HASH_AGGREGATION  */ RB_CARDINALITY(rb_build_agg(c1)), sum(c3) from t1 group by c2 ;
RB_CARDINALITY(rb_build_agg(c1))	sum(c3)
49	990098930
50	1466121230
40	902368320
45	1067098945
44	1153721392
43	1044237732
46	927699172
51	1346478297
59	1470397112
54	1209266664
54	1319236188
41	936769549
52	1345757616
46	1203228914
59	1460692560
59	1658809009
49	1193024837
59	1496792183
52	1388972608
48	1337190720
select /*+ NO_USE_HASH_AGGREGATION  */ count(distinct c1), sum(c3) from t1 group by c2;
count(distinct c1)	sum(c3)
49	990098930
50	1466121230
40	902368320
45	1067098945
44	1153721392
43	1044237732
46	927699172
51	1346478297
59	1470397112
54	1209266664
54	1319236188
41	936769549
52	1345757616
46	1203228914
59	1460692560
59	1658809009
49	1193024837
59	1496792183
52	1388972608
48	1337190720
select c2, RB_CARDINALITY(rb_build_agg(c1)), sum(c3) from t1 group by c2;
c2	RB_CARDINALITY(rb_build_agg(c1))	sum(c3)
455876444704	52	1388972608
455876444708	44	1153721392
455876444707	59	1496792183
455876444698	59	1470397112
455876444702	54	1319236188
455876444690	59	1460692560
455876444703	49	1193024837
455876444692	46	927699172
455876444705	48	1337190720
455876444701	59	1658809009
455876444694	43	1044237732
455876444691	50	1466121230
455876444697	51	1346478297
455876444700	49	990098930
455876444693	52	1345757616
455876444695	45	1067098945
455876444706	40	902368320
455876444699	41	936769549
455876444709	46	1203228914
455876444696	54	1209266664
select c2, count(distinct c1), sum(c3) from t1 group by c2;
c2	count(distinct c1)	sum(c3)
455876444704	52	1388972608
455876444708	44	1153721392
455876444707	59	1496792183
455876444698	59	1470397112
455876444702	54	1319236188
455876444690	59	1460692560
455876444703	49	1193024837
455876444692	46	927699172
455876444705	48	1337190720
455876444701	59	1658809009
455876444694	43	1044237732
455876444691	50	1466121230
455876444697	51	1346478297
455876444700	49	990098930
455876444693	52	1345757616
455876444695	45	1067098945
455876444706	40	902368320
455876444699	41	936769549
455876444709	46	1203228914
455876444696	54	1209266664
select c2, RB_CARDINALITY(rb_build_agg(c1)), sum(c3) from t1 group by c2 with rollup ;
c2	RB_CARDINALITY(rb_build_agg(c1))	sum(c3)
455876444704	52	1388972608
455876444708	44	1153721392
455876444707	59	1496792183
455876444698	59	1470397112
455876444702	54	1319236188
455876444690	59	1460692560
455876444703	49	1193024837
455876444692	46	927699172
455876444705	48	1337190720
455876444701	59	1658809009
455876444694	43	1044237732
455876444691	50	1466121230
455876444697	51	1346478297
455876444700	49	990098930
455876444693	52	1345757616
455876444695	45	1067098945
455876444706	40	902368320
455876444699	41	936769549
455876444709	46	1203228914
455876444696	54	1209266664
NULL	1000	24917961978
select /*+ NO_GBY_PUSHDOWN */ c2, RB_CARDINALITY(rb_build_agg(c1)), sum(c3) from t1 group by c2 with rollup ;
c2	RB_CARDINALITY(rb_build_agg(c1))	sum(c3)
455876444704	52	1388972608
455876444708	44	1153721392
455876444707	59	1496792183
455876444698	59	1470397112
455876444702	54	1319236188
455876444690	59	1460692560
455876444703	49	1193024837
455876444692	46	927699172
455876444705	48	1337190720
455876444701	59	1658809009
455876444694	43	1044237732
455876444691	50	1466121230
455876444697	51	1346478297
455876444700	49	990098930
455876444693	52	1345757616
455876444695	45	1067098945
455876444706	40	902368320
455876444699	41	936769549
455876444709	46	1203228914
455876444696	54	1209266664
NULL	1000	24917961978
drop table if exists t1;
create table t1(id bigint primary key, c1 bigint, c2 bigint, c3 bigint) partition by key(id) partitions 8;
insert into t1 select abs(random(0)), NULL, (abs(random(1))%5+455876444690), abs(random(1)%50000000) from table(generator(100));
select /*+ NO_GBY_PUSHDOWN */ c2, RB_CARDINALITY(rb_build_agg(c1)), sum(c3) from t1 group by c2 with rollup ;
c2	RB_CARDINALITY(rb_build_agg(c1))	sum(c3)
455876444690	NULL	454600205
455876444694	NULL	507553495
455876444692	NULL	449942551
455876444691	NULL	673021307
455876444693	NULL	333774914
NULL	NULL	2418892472
drop table if exists t1;
create table t1(id bigint primary key, c1 decimal(6,2));
select RB_CARDINALITY(rb_build_agg(c1)) from t1;
ERROR HY000: invalid type given for an argument
drop table if exists t1;
