drop database if exists fts_online_ddl;
create database fts_online_ddl;
use fts_online_ddl;
DROP TABLE IF EXISTS fts_table_1;
result_format: 3
CREATE TABLE fts_table_1 (
  id int,
  auto_inc_col int AUTO_INCREMENT,
  name varchar(20),
  title varchar(20),
  content varchar(20),
  /*Indices*/
  FULLTEXT INDEX f102(title) WITH PARSER space);
INSERT INTO fts_table_1 VALUES (1, 1, "name1", "title 1", "content1"),
                               (2, 2, "name2", "title 2", "content2"),
                               (3, 3, "name3", "title 3", "content3");
ALTER TABLE fts_table_1 RENAME INDEX f102 TO f101;
SHOW INDEX FROM fts_table_1;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
fts_table_1	1	f101	1	title	A	NULL	NULL	NULL	YES	FULLTEXT	available		YES	NULL
+--------------------------------+
| table_name                     |
+--------------------------------+
| __idx_*_f101                   |
| __idx_*_f101_fts_doc_word      |
+--------------------------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 ADD COLUMN col int;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 ADD COLUMN virtual_col int GENERATED ALWAYS AS (id+1) VIRTUAL;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+------------+-------------------+
| Field        | Type        | Null | Key | Default    | Extra             |
+--------------+-------------+------+-----+------------+-------------------+
| id           | int(11)     | YES  |     | NULL       |                   |
| auto_inc_col | int(11)     | NO   |     | NULL       | auto_increment    |
| name         | varchar(20) | YES  |     | NULL       |                   |
| title        | varchar(20) | YES  |     | NULL       |                   |
| content      | varchar(20) | YES  |     | NULL       |                   |
| col          | int(11)     | YES  |     | NULL       |                   |
| virtual_col  | int(11)     | YES  |     | (`id` + 1) | VIRTUAL GENERATED |
+--------------+-------------+------+-----+------------+-------------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 DROP COLUMN virtual_col;
ALTER TABLE fts_table_1 MODIFY COLUMN id int NOT NULL;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | NO   |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 MODIFY COLUMN id int NULL;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 MODIFY COLUMN id int DEFAULT 0;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | 0       |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 MODIFY id int DEFAULT NULL;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 AUTO_INCREMENT = 101;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| title        | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 RENAME COLUMN title TO titles;
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(20) | YES  |     | NULL    |                |
| titles       | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_1 MODIFY name varchar(30);
DESCRIBE fts_table_1;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(30) | YES  |     | NULL    |                |
| titles       | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_1 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
DROP TABLE IF EXISTS fts_table_2;
DROP TABLE IF EXISTS fts_fk_table;
CREATE TABLE fts_table_2 (
  id int,
  auto_inc_col int AUTO_INCREMENT,
  name varchar(20),
  title varchar(20),
  content varchar(20),
  /*Indices*/
  FULLTEXT INDEX f102(title) WITH PARSER space);
CREATE TABLE fts_fk_table (
  id int PRIMARY KEY,
  child_id int);
INSERT INTO fts_fk_table VALUES (1, 1), (2, 2), (3, 3);
INSERT INTO fts_table_2 VALUES (1, 1, "name1", "title 1", "content1"),
                               (2, 2, "name2", "title 2", "content2"),
                               (3, 3, "name3", "title 3", "content3");
ALTER TABLE fts_table_2 ADD CONSTRAINT fk_constraint FOREIGN KEY (id) REFERENCES fts_fk_table(id);
SHOW CREATE TABLE fts_table_2;
Table	Create Table
fts_table_2	CREATE TABLE `fts_table_2` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `title` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  CONSTRAINT `fk_constraint` FOREIGN KEY (`id`) REFERENCES `fts_online_ddl`.`fts_fk_table`(`id`) ON UPDATE RESTRICT ON DELETE RESTRICT ,
  FULLTEXT KEY `f102` (`title`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384
) ORGANIZATION INDEX AUTO_INCREMENT = 4 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_2 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_2 DROP FOREIGN KEY fk_constraint;
SHOW CREATE TABLE fts_table_2;
Table	Create Table
fts_table_2	CREATE TABLE `fts_table_2` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `title` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  FULLTEXT KEY `f102` (`title`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384
) ORGANIZATION INDEX AUTO_INCREMENT = 4 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_2 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_2 ADD CONSTRAINT cons CHECK (id <= 10000);
SHOW CREATE TABLE fts_table_2;
Table	Create Table
fts_table_2	CREATE TABLE `fts_table_2` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `title` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  FULLTEXT KEY `f102` (`title`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384,
  CONSTRAINT `cons` CHECK ((`id` <= 10000))
) ORGANIZATION INDEX AUTO_INCREMENT = 4 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_2 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_2 DROP CONSTRAINT cons;
SHOW CREATE TABLE fts_table_2;
Table	Create Table
fts_table_2	CREATE TABLE `fts_table_2` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `title` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  FULLTEXT KEY `f102` (`title`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384
) ORGANIZATION INDEX AUTO_INCREMENT = 4 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_2 WHERE MATCH (title) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
DROP TABLE fts_table_2;
DROP TABLE fts_fk_table;
DROP TABLE IF EXISTS fts_table_3;
RENAME TABLE fts_table_1 TO fts_table_3;
DESCRIBE fts_table_3;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | YES  |     | NULL    |                |
| auto_inc_col | int(11)     | NO   |     | NULL    | auto_increment |
| name         | varchar(30) | YES  |     | NULL    |                |
| titles       | varchar(20) | YES  |     | NULL    |                |
| content      | varchar(20) | YES  |     | NULL    |                |
| col          | int(11)     | YES  |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
SELECT name FROM fts_table_3 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_3 ROW_FORMAT=COMPACT;
SHOW CREATE TABLE fts_table_3;
Table	Create Table
fts_table_3	CREATE TABLE `fts_table_3` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) DEFAULT NULL,
  `titles` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  `col` int(11) DEFAULT NULL,
  FULLTEXT KEY `f101` (`titles`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384
) ORGANIZATION INDEX AUTO_INCREMENT = 101 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = COMPACT COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_3 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_3 BLOCK_SIZE=2048;
SHOW CREATE TABLE fts_table_3;
Table	Create Table
fts_table_3	CREATE TABLE `fts_table_3` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) DEFAULT NULL,
  `titles` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  `col` int(11) DEFAULT NULL,
  FULLTEXT KEY `f101` (`titles`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 2048
) ORGANIZATION INDEX AUTO_INCREMENT = 101 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = COMPACT COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 2048 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_3 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
ALTER TABLE fts_table_3 COMPRESSION='lz4_1.0';
SHOW CREATE TABLE fts_table_3;
Table	Create Table
fts_table_3	CREATE TABLE `fts_table_3` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) DEFAULT NULL,
  `titles` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  `col` int(11) DEFAULT NULL,
  FULLTEXT KEY `f101` (`titles`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 2048
) ORGANIZATION INDEX AUTO_INCREMENT = 101 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = COMPACT COMPRESSION = 'lz4_1.0' REPLICA_NUM = replica_num BLOCK_SIZE = 2048 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_3 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
OPTIMIZE TABLE fts_table_3;
SHOW CREATE TABLE fts_table_3;
Table	Create Table
fts_table_3	CREATE TABLE `fts_table_3` (
  `id` int(11) DEFAULT NULL,
  `auto_inc_col` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(30) DEFAULT NULL,
  `titles` varchar(20) DEFAULT NULL,
  `content` varchar(20) DEFAULT NULL,
  `col` int(11) DEFAULT NULL,
  FULLTEXT KEY `f101` (`titles`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 2048
) ORGANIZATION INDEX AUTO_INCREMENT = 101 AUTO_INCREMENT_MODE = 'ORDER' DEFAULT CHARSET = utf8mb4 ROW_FORMAT = COMPACT COMPRESSION = 'lz4_1.0' REPLICA_NUM = replica_num BLOCK_SIZE = 2048 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
SELECT name FROM fts_table_3 WHERE MATCH (titles) AGAINST ("title") order by name;
+-------+
| name  |
+-------+
| name1 |
| name2 |
| name3 |
+-------+
DROP TABLE fts_table_3;
create table fts_table(c1 int, name varchar(20), fulltext index f102(name))
partition by range(c1)
(partition p1 values less than(10),
partition p2 values less than(20));
insert into fts_table values(3, "jack a");
insert into fts_table values(7, "jack b");
insert into fts_table values(17, "jerry a");
alter table fts_table add partition (partition p3 values less than(30));
insert into fts_table values(27, "jerry b");
select * from fts_table order by 1;
+------+---------+
| c1   | name    |
+------+---------+
|    3 | jack a  |
|    7 | jack b  |
|   17 | jerry a |
|   27 | jerry b |
+------+---------+
alter table fts_table add partition (partition p4 values less than(40), partition p5 values less than(50));
show create table fts_table;
Table	Create Table
fts_table	CREATE TABLE `fts_table` (
  `c1` int(11) DEFAULT NULL,
  `name` varchar(20) DEFAULT NULL,
  FULLTEXT KEY `f102` (`name`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
 partition by range(c1)
(partition `p1` values less than (10),
partition `p2` values less than (20),
partition `p3` values less than (30),
partition `p4` values less than (40),
partition `p5` values less than (50))
drop table fts_table;
