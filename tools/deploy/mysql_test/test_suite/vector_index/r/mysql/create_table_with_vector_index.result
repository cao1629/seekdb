drop database if exists yjl_vec;
create database yjl_vec;
use yjl_vec;
alter system set ob_vector_memory_limit_percentage = 20;


"------------------------------- not support vec index and fts in same table -------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 varchar(3), c4 vector(3), c5 varchar(3), vector index idx1(c2) with (distance=l2, type=hnsw), fulltext index idx2(c3));
drop table if exists t_vec;
create table t_vec(c1 int primary key, c2 vector(3), c3 varchar(3), c4 vector(3), c5 varchar(3));
create vector index idx1 on t_vec(c2) with (distance=l2, type=hnsw);
create fulltext index idx2 on t_vec(c3);
create vector index idx3 on t_vec(c4) with (distance=l2, type=hnsw);
create index idx4 on t_vec(c1);
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` varchar(3) DEFAULT NULL,
  `c4` VECTOR(3) DEFAULT NULL,
  `c5` varchar(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384,
  FULLTEXT KEY `idx2` (`c3`) WITH PARSER space PARSER_PROPERTIES=(min_token_size=3,max_token_size=84) BLOCK_SIZE 16384,
  VECTOR KEY `idx3` (`c4`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384,
  KEY `idx4` (`c1`) BLOCK_SIZE 16384 LOCAL
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
t_vec	1	idx2	1	c3	A	NULL	NULL	NULL	YES	FULLTEXT	available		YES	NULL
t_vec	1	idx3	1	c4	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
t_vec	1	idx4	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
drop table t_vec;


"---------------------------------not support vec index dim larger then 4096 or equql to 0-------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(4097), primary key(c1), vector index idx1(c2) with (distance=l2, type=hnsw));
ERROR 0A000: vec index dim larger than 4096 is not supported
create table t_vec(c1 int, c2 vector(0), primary key(c1), vector index idx1(c2) with (distance=l2, type=hnsw));
ERROR 0A000: vector column dim less or equal to zero or larger than 16000 is not supported


"---------------------------------not support multi index column --------------------------------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 vector(3), primary key(c1), vector index idx1(c1,c3) with (distance=l2, type=hnsw));
ERROR 0A000: multi vector index column is not supported
create table t_vec(c1 int, c2 vector(3), c3 vector(3), primary key(c1), vector index idx1(c2,c3) with (distance=l2, type=hnsw));
ERROR 0A000: multi vector index column is not supported
create table t_vec(c1 int, c2 vector(3), c3 vector(3), primary key(c1));
create vector index idx1 on t_vec(c2,c3) with (distance=l2, type=hnsw);
ERROR 0A000: multi vector index column is not supported
create vector index idx1 on t_vec(c1,c3) with (distance=l2, type=hnsw);
ERROR 0A000: multi vector index column is not supported


"---------------------------------not support more than one vector index on same column -----------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 vector(3), c4 vector(3), primary key(c1), vector index idx1(c2) with (distance=l2, type=hnsw), vector index idx2(c2) with (distance=l2, type=hnsw));
ERROR 0A000: more than one vector index on same column is not supported
create table t_vec(c1 int, c2 vector(3), c3 vector(3), c4 vector(3), primary key(c1), vector index idx1(c2) with (distance=l2, type=hnsw), vector index idx2(c3) with (distance=l2, type=hnsw), vector index idx3(c2) with (distance=l2, type=hnsw));
ERROR 0A000: more than one vector index on same column is not supported
create table t_vec(c1 int, c2 vector(3), c3 vector(3), primary key(c1));
create vector index idx1 on t_vec(c2) with (distance=l2, type=hnsw);
create vector index idx2 on t_vec(c2) with (distance=l2, type=hnsw);
ERROR 0A000: create vector index on column has vector index is not supported
create vector index idx3 on t_vec(c3) with (distance=l2, type=hnsw);


"-------------------------------------not support same index name ----------------------------------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 vector(3), c4 int, primary key(c1), index idx1(c4), vector index idx1(c2) with (distance=l2, type=hnsw));
ERROR 42000: Duplicate key name 'idx1'
create table t_vec(c1 int, c2 vector(3), c3 vector(3), c4 int, primary key(c1), vector index idx1(c2) with (distance=l2, type=hnsw));
create index idx1 on t_vec(c4);
ERROR 42000: Duplicate key name 'idx1'
create vector index idx1 on t_vec(c3) with (distance=l2, type=hnsw);
ERROR 42000: Duplicate key name 'idx1'
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` VECTOR(3) DEFAULT NULL,
  `c4` int(11) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL


"---------------------------------normal create ---------------------------------------------------------------------------"
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c1));
ERROR HY000: Column 'c1' cannot be part of VECTOR index
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2));
ERROR 0A000: vector index params not set is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2));
ERROR 0A000: vector index params not set distance and type is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag));
ERROR 0A000: the vector index params of distance or type not set is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=xxx));
ERROR 0A000: this type of vector index type is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m=130));
ERROR 0A000: this value of vector index m is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m1=100));
ERROR 0A000: unexpected vector index params items is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m=64, ef_construction=1001));
ERROR 0A000: this value of vector index ef_construction is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, ef_construction=10));
ERROR 0A000: the vector index params ef_construction less than or equal to m value is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m=64, ef_construction=63));
ERROR 0A000: the vector index params ef_construction less than or equal to m value is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m=64, ef_construction=64));
ERROR 0A000: the vector index params ef_construction less than or equal to m value is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=hnsw, m=64, ef_construction=1000, ef_search=160001));
ERROR 0A000: this value of vector index ef_search is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l3, lib=vsag, type=hnsw, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: this type of vector index distance algorithm is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=xxx, type=hnsw, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: this type of vector index lib is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type=xxx, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: this type of vector index type is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance1=l2, lib=vsag, type=hnsw, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: unexpected vector index params items is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib1=vsag, type=hnsw, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: unexpected vector index params items is not supported
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with(distance=l2, lib=vsag, type1=hnsw, m=64, ef_construction=1000, ef_search=1000));
ERROR 0A000: unexpected vector index params items is not supported
create table t_vec(c1 int, c2 vector(3), c3 int, primary key(c1), vector index idx1(c2) storing (c3) with (distance=l2, type=hnsw));
ERROR 0A000: setting vector index storing column is not supported


"----------------------------------------- specify case ---------------------------------------------------------------"
alter system set ob_vector_memory_limit_percentage = 20;
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with (distance=L2, type=hnsw));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with (distance=inner_product, type=hnsw));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=INNER_PRODUCT, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 vector(3), primary key(c1), vector index idx1(c2) with (distance=L2, type=hnsw), vector index idx2(c3) with (distance=L2, type=hnsw));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384,
  VECTOR KEY `idx2` (`c3`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
t_vec	1	idx2	1	c3	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with (distance=L2, type=hnsw, lib=vsag, m=20));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=20, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with (distance=L2, type=hnsw, lib=vsag, m=20, ef_construction=200));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=20, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), primary key(c1), vector index idx1(c2) with (distance=L2, type=hnsw, lib=vsag, m=20, ef_construction=200, ef_search=200));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=20, EF_CONSTRUCTION=200, EF_SEARCH=200) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 int, primary key(c1), vector index idx1(c2) with(distance=l2, type=hnsw));
create index idx2 on t_vec(c3);
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` int(11) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384,
  KEY `idx2` (`c3`) BLOCK_SIZE 16384 LOCAL
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
show index from t_vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Visible	Expression
t_vec	0	PRIMARY	1	c1	A	NULL	NULL	NULL		BTREE	available		YES	NULL
t_vec	1	idx1	1	c2	A	NULL	NULL	NULL	YES	VECTOR	available		YES	NULL
t_vec	1	idx2	1	c3	A	NULL	NULL	NULL	YES	BTREE	available		YES	NULL
drop table if exists t_vec;
create table t_vec(c1 int, c2 vector(3), c3 int, c4 int, c5 int, c6 int, primary key(c1), vector index idx1(c2) with(distance=l2, type=hnsw));
create index vid_rowkey_table on t_vec(c3);
create index rowkey_vid_table on t_vec(c4);
create index idx1_index_id_table on t_vec(c5);
create index idx1_index_snapshot_data_table on t_vec(c6);
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` int(11) DEFAULT NULL,
  `c4` int(11) DEFAULT NULL,
  `c5` int(11) DEFAULT NULL,
  `c6` int(11) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384,
  KEY `vid_rowkey_table` (`c3`) BLOCK_SIZE 16384 LOCAL,
  KEY `rowkey_vid_table` (`c4`) BLOCK_SIZE 16384 LOCAL,
  KEY `idx1_index_id_table` (`c5`) BLOCK_SIZE 16384 LOCAL,
  KEY `idx1_index_snapshot_data_table` (`c6`) BLOCK_SIZE 16384 LOCAL
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
drop table if exists t_vec;
create table t_vec(c1 int primary key, c2 vector(3), c3 vector(3), c4 vector(3), vector index vector_idx(c3) with (distance=l2, type=hnsw));
insert into t_vec(c1,c2,c3,c4) values(1,'[1,1,2]','[2,2,3]','[1,3,2]');
create materialized view mv1 refresh complete on demand as select c1,c2,c3,c4 from t_vec ;
create vector index vector_idx on mv1 (c2) with (distance=l2, type=hnsw);
ERROR 0A000: create vector index on view table is not supported
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` VECTOR(3) DEFAULT NULL,
  `c4` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `vector_idx` (`c3`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
drop materialized view mv1;
drop table if exists t_vec;
drop view if exists v1;
create table t_vec(c1 int primary key, c2 vector(3), c3 vector(3), c4 vector(3));
create view v1 as select * from t_vec;
insert into v1(c1,c2,c3,c4) values(1,'[1,1,2]','[2,2,3]','[1,3,2]');
create vector index vector_idx_c2 on v1(c2) with (distance=l2, type=hnsw);
ERROR 0A000: create vector index on view table is not supported
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` VECTOR(3) DEFAULT NULL,
  `c4` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`)
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
drop view if exists v1;
drop table if exists t_vec;
create table t_vec(c1 int primary key, c2 vector(3), c3 vector(3), c4 vector(3), vector index vector_idx(c3) with (distance=l2, type=hnsw));
insert into t_vec(c1,c2,c3,c4) values(1,'[1,1,2]','[2,2,3]','[1,3,2]');
create materialized view mv1(primary key(c2)) refresh complete on demand as select c1,c2 from t_vec ;
ERROR 42000: The used storage engine can't index column 'c2'
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) NOT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  `c3` VECTOR(3) DEFAULT NULL,
  `c4` VECTOR(3) DEFAULT NULL,
  PRIMARY KEY (`c1`),
  VECTOR KEY `vector_idx` (`c3`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
drop table if exists t_vec;
create table t_vec(c1 vector(3), c2 vector(3), c3 vector(4), c4 int, c5 json, c6 char(20), vector index idx_1((c1+c2)) with (distance=l2, type=hnsw));
ERROR HY000: Functional index on a column is not supported. Consider using a regular index instead.
create table t_vec(c1 vector(3), c2 vector(3), c3 vector(4), c4 int, c5 json, c6 char(20));
create vector index idx_1 on t_vec((c1 + c2)) with (distance=l2, type=hnsw);
ERROR HY000: Functional index on a column is not supported. Consider using a regular index instead.
drop table t_vec;
create table t_vec(c1 int, c2 vector(3), vector index idx1(c2) with (distance=L2, type=hnsw));
show create table t_vec;
Table	Create Table
t_vec	CREATE TABLE `t_vec` (
  `c1` int(11) DEFAULT NULL,
  `c2` VECTOR(3) DEFAULT NULL,
  VECTOR KEY `idx1` (`c2`) WITH (DISTANCE=L2, TYPE=HNSW, LIB=VSAG, M=16, EF_CONSTRUCTION=200, EF_SEARCH=64) BLOCK_SIZE 16384
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 ROW_FORMAT = DYNAMIC COMPRESSION = 'zstd_1.3.8' REPLICA_NUM = replica_num BLOCK_SIZE = 16384 USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = 134217728 PCTFREE = 0
drop table if exists t_vec;
drop database if exists yjl_vec;
alter system set ob_vector_memory_limit_percentage = 0;
PURGE RECYCLEBIN;
