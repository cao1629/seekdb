# Vector Index Multi Partitioned Test
drop table if exists t1;
set ob_enable_index_direct_select = 1;
alter system set ob_vector_memory_limit_percentage = 25;
alter system set vector_index_optimize_duty_time = '[00:00:00, 00:00:00]';
CREATE TABLE t1(c1 INT, c3 vector(3), c4 vector(5),
primary key(c1),
vector index idx1(c3) with (distance=l2, type=hnsw, lib=vsag),
vector index idx2(c4) with (distance=l2, type=hnsw, lib=vsag))
PARTITION BY RANGE COLUMNS(c1)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx2','t1','c4');
count(*)
0
count(*)
0
count(*)
65
count(*)
0
count(*)
0
count(*)
5
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
CREATE TABLE t1(c1 INT, c3 vector(3), c4 vector(5),
primary key(c1))
PARTITION BY RANGE COLUMNS(c1)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
create vector index idx1 on t1(c3) with (distance=l2, type=hnsw, lib=vsag);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx1','t1','c3');
count(*)
0
count(*)
0
count(*)
5
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
CREATE TABLE t1(c1 INT, c3 vector(3), c4 vector(5),
primary key(c1))
PARTITION BY RANGE COLUMNS(c1)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
create vector index idx1 on t1(c3) with (distance=l2, type=hnsw, lib=vsag);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
5	[0.472683,0.68931,0.557456]	[0.673995,0.712286,0.232643,0.88223,0.332458]
6	[0.700344,0.636797,0.680745]	[0.836732,0.576614,0.71673,0.497944,0.083971]
7	[0.355561,0.673233,0.489047]	[0.195097,0.771938,0.598812,0.680604,0.902516]
8	[0.212209,0.611219,0.473053]	[0.898162,0.151031,0.842752,0.315086,0.672002]
1	[0.149599,0.57074,0.487505]	[0.275799,0.239371,0.875098,0.947923,0.617502]
3	[0.016783,0.253643,0.675691]	[0.825696,0.651377,0.749575,0.61606,0.817642]
10	[0.366178,0.460159,0.299666]	[0.199013,0.855834,0.096874,0.107032,0.686917]
2	[0.055335,0.390351,0.393264]	[0.213549,0.543877,0.337553,0.505269,0.96888]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
110	[0.49189,0.709275,0.517524]	[0.234022,0.046709,0.824433,0.345454,0.159983]
104	[0.106963,0.230432,0.445725]	[0.286398,0.251989,0.699914,0.732867,0.118455]
101	[0.974202,0.41943,0.558433]	[0.173808,0.450608,0.116523,0.9057,0.452609]
111	[0.929073,0.056943,0.696875]	[0.467718,0.678949,0.486491,0.704404,0.741581]
107	[0.020425,0.804245,0.49596]	[0.388839,0.177899,0.502872,0.776442,0.154382]
106	[0.012709,0.280118,0.233525]	[0.352525,0.865018,0.044823,0.473914,0.643859]
109	[0.887048,0.922763,0.772979]	[0.347203,0.766619,0.341606,0.129618,0.19985]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
207	[0.230544,0.638751,0.739269]	[0.731637,0.213119,0.783161,0.275731,0.728576]
211	[0.549441,0.134372,0.613989]	[0.511034,0.327043,0.161602,0.030086,0.189717]
205	[0.703073,0.446181,0.414792]	[0.673538,0.992595,0.671284,0.38794,0.828633]
203	[0.874715,0.272202,0.947316]	[0.441439,0.093345,0.922398,0.053189,0.305856]
204	[0.005739,0.66573,0.66543]	[0.802783,0.999697,0.031144,0.436719,0.394391]
201	[0.889676,0.144233,0.621488]	[0.579793,0.203273,0.473667,0.975557,0.926981]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
410	[0.604378,0.61165,0.862443]	[0.123246,0.974225,0.264604,0.324832,0.785904]
309	[0.164721,0.428994,0.497853]	[0.475899,0.130334,0.344967,0.807805,0.354151]
409	[0.604009,0.165262,0.480569]	[0.801519,0.945876,0.457997,0.362987,0.613519]
406	[0.83208,0.345807,0.85513]	[0.637708,0.627566,0.211239,0.483256,0.498936]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
10006	[0.31728,0.633151,0.869567]	[0.074736,0.220758,0.973441,0.57403,0.716675]
10002	[0.727333,0.541419,0.761837]	[0.990355,0.769272,0.895844,0.067357,0.229505]
10005	[0.733289,0.678967,0.658886]	[0.952971,0.169767,0.163808,0.14697,0.536974]
10010	[0.093298,0.155263,0.912444]	[0.202052,0.397973,0.881438,0.23544,0.730696]
10009	[0.798959,0.694619,0.713657]	[0.239206,0.467229,0.325436,0.188116,0.694612]
10011	[0.837984,0.621488,0.645501]	[0.915391,0.972475,0.979022,0.598947,0.038447]
10003	[0.457325,0.857359,0.583796]	[0.367617,0.928321,0.909448,0.857162,0.060043]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx1','t1','c3');
count(*)
0
count(*)
0
count(*)
5
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c3	c4
301	[0.372756,0.478767,0.687012]	[0.556772,0.686932,0.044378,0.455043,0.146903]
10004	[0.371932,0.350298,0.642431]	[0.886086,0.46575,0.458321,0.236174,0.639572]
401	[0.287521,0.43823,0.644009]	[0.378725,0.784441,0.109615,0.755686,0.944128]
311	[0.485425,0.213736,0.833686]	[0.888108,0.820035,0.229685,0.354559,0.497037]
303	[0.638491,0.459974,0.858031]	[0.737866,0.48335,0.527329,0.493356,0.349209]
209	[0.474039,0.395218,0.517512]	[0.122741,0.751525,0.220055,0.209862,0.010188]
210	[0.561294,0.606158,0.651839]	[0.898397,0.09801,0.877262,0.541335,0.009982]
105	[0.206043,0.473185,0.637318]	[0.53166,0.946986,0.676358,0.738766,0.639734]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
CREATE TABLE t1(c1 INT not null auto_increment, c2 INT, c3 vector(3), c4 vector(5),
primary key(c1,c2),
vector index idx1(c3) with (distance=l2, type=hnsw, lib=vsag),
vector index idx2(c4) with (distance=l2, type=hnsw, lib=vsag))
PARTITION BY RANGE COLUMNS(c1)
SUBPARTITION BY LIST COLUMNS(c2)
SUBPARTITION TEMPLATE
(
SUBPARTITION mp0 VALUES IN (1,2,3,4,5),
SUBPARTITION mp1 VALUES IN (6,7,8,9,10),
SUBPARTITION mp2 VALUES IN (11,12,13,14,15),
SUBPARTITION mp3 VALUES IN (16,17,18,19,20)
)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx2','t1','c4');
count(*)
0
count(*)
0
count(*)
54
count(*)
0
count(*)
0
count(*)
18
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
CREATE TABLE t1(c1 INT not null auto_increment, c2 INT, c3 vector(3), c4 vector(5),
primary key(c1,c2))
PARTITION BY RANGE COLUMNS(c1)
SUBPARTITION BY LIST COLUMNS(c2)
SUBPARTITION TEMPLATE
(
SUBPARTITION mp0 VALUES IN (1,2,3,4,5),
SUBPARTITION mp1 VALUES IN (6,7,8,9,10),
SUBPARTITION mp2 VALUES IN (11,12,13,14,15),
SUBPARTITION mp3 VALUES IN (16,17,18,19,20)
)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
create vector index idx1 on t1(c3) with (distance=l2, type=hnsw, lib=vsag);
create vector index idx2 on t1(c4) with (distance=l2, type=hnsw, lib=vsag);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx2','t1','c4');
count(*)
0
count(*)
0
count(*)
54
count(*)
0
count(*)
0
count(*)
18
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
CREATE TABLE t1(c1 INT not null auto_increment, c2 INT, c3 vector(3), c4 vector(5),
primary key(c1,c2))
PARTITION BY RANGE COLUMNS(c1)
SUBPARTITION BY LIST COLUMNS(c2)
SUBPARTITION TEMPLATE
(
SUBPARTITION mp0 VALUES IN (1,2,3,4,5),
SUBPARTITION mp1 VALUES IN (6,7,8,9,10),
SUBPARTITION mp2 VALUES IN (11,12,13,14,15),
SUBPARTITION mp3 VALUES IN (16,17,18,19,20)
)
(
PARTITION p0 VALUES LESS THAN(100),
PARTITION p1 VALUES LESS THAN(200),
PARTITION p2 VALUES LESS THAN(300),
PARTITION p3 VALUES LESS THAN(10000),
PARTITION p4 VALUES LESS THAN MAXVALUE
);
create vector index idx1 on t1(c3) with (distance=l2, type=hnsw, lib=vsag);
create vector index idx2 on t1(c4) with (distance=l2, type=hnsw, lib=vsag);
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
7	6	[23,22,5]	[17,6,84,93,78]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
3	8	[1,55,37]	[84,3,4,66,83]
4	6	[24,43,59]	[98,15,64,18,6]
1	6	[29,79,53]	[93,99,53,81,73]
6	14	[80,39,47]	[35,6,89,16,84]
5	1	[38,94,39]	[49,48,55,61,100]
select count(*) from (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p0) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
105	2	[3,13,46]	[18,13,7,71,93]
101	10	[41,28,38]	[92,79,42,92,73]
110	9	[32,57,1]	[20,46,76,90,72]
109	19	[8,55,43]	[73,35,30,70,33]
104	19	[49,53,28]	[98,76,72,19,71]
103	18	[21,72,23]	[40,52,4,23,4]
108	14	[1,78,45]	[76,50,77,15,80]
106	7	[60,31,67]	[55,97,53,49,34]
select count(*) from (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p1) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
202	8	[71,6,30]	[20,58,9,83,53]
207	11	[2,37,71]	[19,19,15,34,61]
201	3	[48,6,68]	[87,32,18,79,37]
203	15	[37,60,51]	[45,39,42,20,44]
208	6	[70,4,52]	[23,65,72,32,33]
206	10	[48,76,40]	[46,19,30,28,54]
210	9	[56,45,79]	[33,62,73,27,84]
211	10	[35,77,74]	[24,74,93,65,58]
select count(*) from (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p2) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
301	1	[67,6,13]	[59,70,77,37,17]
310	2	[59,34,11]	[59,62,15,48,88]
303	4	[65,6,24]	[61,3,98,13,45]
307	4	[71,48,51]	[52,58,22,42,25]
311	8	[33,23,100]	[46,71,75,30,50]
305	1	[40,87,63]	[26,6,4,89,84]
select count(*) from (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p3) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
10009	6	[15,46,5]	[74,34,52,94,77]
10004	12	[36,47,50]	[27,47,98,95,61]
10005	8	[72,34,24]	[8,84,33,82,12]
10010	9	[72,27,38]	[72,90,31,30,28]
10011	19	[32,68,44]	[42,60,33,93,15]
10002	11	[39,13,91]	[45,40,74,85,74]
10007	5	[77,100,24]	[21,47,61,26,16]
select count(*) from (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 partition(p4) order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
call dbms_vector.refresh_index('idx1', 't1', 'c3', 1, 'FAST');
call dbms_vector.rebuild_index('idx2','t1','c4');
count(*)
0
count(*)
0
count(*)
0
count(*)
0
count(*)
18
count(*)
18
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8;
c1	c2	c3	c4
10008	9	[5,6,2]	[11,87,32,94,87]
309	15	[4,21,11]	[96,32,84,65,26]
306	2	[10,27,11]	[83,100,33,23,9]
7	6	[23,22,5]	[17,6,84,93,78]
105	2	[3,13,46]	[18,13,7,71,93]
10009	6	[15,46,5]	[74,34,52,94,77]
10	19	[7,27,43]	[81,48,91,29,75]
8	16	[25,19,46]	[42,66,68,1,12]
select count(*) from (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) APPROXIMATE limit 8) as tmp1, (select * from t1 order by l2_distance(c3, [0.428146,0.408760,0.765300]) limit 8) as tmp2 where tmp1.c1=tmp2.c1;
count(*)
8
drop table t1;
alter system set ob_vector_memory_limit_percentage = 0;
select count(*) as count from oceanbase.__all_virtual_vector_index_info a, oceanbase.__all_virtual_table b  where a.data_table_id = b.table_id and b.table_name = 't1';
count
0
PURGE RECYCLEBIN;
