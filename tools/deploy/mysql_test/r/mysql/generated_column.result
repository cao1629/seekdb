drop table if exists t, t1, t2, t3;
result_format: 4
create table t1(c1 varchar(10) primary key, c2 varchar(8) generated always as (substring(c1, 2)) virtual, c3 int) partition by key(c2) partitions 5;

explain basic  insert into t1 (c1, c3) values('abcde', 10);
Query Plan
============================
|ID|OPERATOR          |NAME|
----------------------------
|0 |DISTRIBUTED INSERT|    |
|1 |└─EXPRESSION      |    |
============================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      columns([{t1: ({t1: (t1.c1, t1.c2, t1.c3)})}]),
      column_values([column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1)], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,column_conv(VARCHAR,
      utf8mb4_general_ci,length:8,NULL,substr(column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1), 2)))], [column_conv(INT,PS:(11,0),NULL,__values.c3)])
  1 - output([__values.c1], [__values.c3]), filter(nil)
      values({'abcde', 10})

insert into t1 (c1, c3) values('abcde', 10);

explain basic select * from t1 where c2 = 'bcde';
Query Plan
=========================
|ID|OPERATOR       |NAME|
-------------------------
|0 |TABLE FULL SCAN|t1  |
=========================
Outputs & filters:
-------------------------------------
  0 - output([t1.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t1.c1, 2))], [t1.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t1.c1, 2)) = 'bcde']), rowset=16
      access([t1.c1], [t1.c3]), partitions(p4)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t1.c1]), range(MIN ; MAX)always true

select * from t1 where c2 = 'bcde';
+-------+------+------+
| c1    | c2   | c3   |
+-------+------+------+
| abcde | bcde |   10 |
+-------+------+------+

explain basic update t1 set c1 = 'ab' where c2 = 'bcde';
Query Plan
============================
|ID|OPERATOR          |NAME|
----------------------------
|0 |DISTRIBUTED UPDATE|    |
|1 |└─TABLE FULL SCAN |t1  |
============================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      table_columns([{t1: ({t1: (t1.c1, t1.c2, t1.c3)})}]),
      update([t1.c1=column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,'ab')], [t1.c2=column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,column_conv(VARCHAR,
      utf8mb4_general_ci,length:8,NULL,substr(column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,'ab'), 2)))])
  1 - output([t1.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t1.c1, 2))], [t1.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t1.c1, 2)) = 'bcde']), rowset=16
      access([t1.c1], [t1.c3]), partitions(p4)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t1.c1]), range(MIN ; MAX)always true

update t1 set c1 = 'ab' where c2 = 'bcde';

explain basic update t1 set c1 = 'abcde' where c2 = 'bcde';
Query Plan
============================
|ID|OPERATOR          |NAME|
----------------------------
|0 |DISTRIBUTED UPDATE|    |
|1 |└─TABLE FULL SCAN |t1  |
============================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      table_columns([{t1: ({t1: (t1.c1, t1.c2, t1.c3)})}]),
      update([t1.c1=column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,'abcde')], [t1.c2=column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,column_conv(VARCHAR,
      utf8mb4_general_ci,length:8,NULL,substr(column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,'abcde'), 2)))])
  1 - output([t1.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t1.c1, 2))], [t1.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t1.c1, 2)) = 'bcde']), rowset=16
      access([t1.c1], [t1.c3]), partitions(p4)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t1.c1]), range(MIN ; MAX)always true

update t1 set c1 = 'abcde' where c2 = 'bcde';

explain basic delete from t1 where c2 = 'bcde';
Query Plan
===========================
|ID|OPERATOR         |NAME|
---------------------------
|0 |DELETE           |    |
|1 |└─TABLE FULL SCAN|t1  |
===========================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      table_columns([{t1: ({t1: (t1.c1, t1.c2, t1.c3)})}])
  1 - output([t1.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t1.c1, 2))], [t1.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t1.c1, 2)) = 'bcde']), rowset=16
      access([t1.c1], [t1.c3]), partitions(p4)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t1.c1]), range(MIN ; MAX)always true

delete from t1 where c2 = 'bcde';

select/*+read_consistency(weak)*/ * from t1;
+----+------+------+
| c1 | c2   | c3   |
+----+------+------+
| ab | b    |   10 |
+----+------+------+

create table t2(c1 varchar(10) primary key, c2 varchar(8) generated always as (substring(c1, 2)) virtual, c3 int, unique key t31(c3, c1, c2) local) partition by key(c2) partitions 5;

explain basic insert into t2 (c1, c3) values('bcde', 1);
Query Plan
============================
|ID|OPERATOR          |NAME|
----------------------------
|0 |DISTRIBUTED INSERT|    |
|1 |└─EXPRESSION      |    |
============================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      columns([{t2: ({t2: (t2.c1, t2.c2, t2.c3)})}]),
      column_values([column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1)], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,column_conv(VARCHAR,
      utf8mb4_general_ci,length:8,NULL,substr(column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1), 2)))], [column_conv(INT,PS:(11,0),NULL,__values.c3)])
  1 - output([__values.c1], [__values.c3]), filter(nil)
      values({'bcde', 1})

insert into t2 (c1, c3) values('bcde', 1);

explain basic insert into t2 (c1, c3) values('baaaa', 1);
Query Plan
============================
|ID|OPERATOR          |NAME|
----------------------------
|0 |DISTRIBUTED INSERT|    |
|1 |└─EXPRESSION      |    |
============================
Outputs & filters:
-------------------------------------
  0 - output(nil), filter(nil)
      columns([{t2: ({t2: (t2.c1, t2.c2, t2.c3)})}]),
      column_values([column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1)], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,column_conv(VARCHAR,
      utf8mb4_general_ci,length:8,NULL,substr(column_conv(VARCHAR,utf8mb4_general_ci,length:10,NOT NULL,__values.c1), 2)))], [column_conv(INT,PS:(11,0),NULL,__values.c3)])
  1 - output([__values.c1], [__values.c3]), filter(nil)
      values({'baaaa', 1})

insert into t2 (c1, c3) values('baaaa', 1);

explain basic select * from t2 where c1 = 'bcde';
Query Plan
===================
|ID|OPERATOR |NAME|
-------------------
|0 |TABLE GET|t2  |
===================
Outputs & filters:
-------------------------------------
  0 - output([t2.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2))], [t2.c3]), filter(nil), rowset=16
      access([t2.c1], [t2.c3]), partitions(p0)
      is_index_back=false, is_global_index=false,
      range_key([t2.c1]), range[bcde ; bcde],
      range_cond([t2.c1 = 'bcde'])

select * from t2 where c1 = 'bcde';
+------+------+------+
| c1   | c2   | c3   |
+------+------+------+
| bcde | cde  |    1 |
+------+------+------+

explain basic select * from t2 where c2 = 'cde' or c2 = 'aaaa';
Query Plan
=======================================
|ID|OPERATOR                 |NAME    |
---------------------------------------
|0 |PX COORDINATOR           |        |
|1 |└─EXCHANGE OUT DISTR     |:EX10000|
|2 |  └─PX PARTITION ITERATOR|        |
|3 |    └─TABLE FULL SCAN    |t2      |
=======================================
Outputs & filters:
-------------------------------------
  0 - output([INTERNAL_FUNCTION(t2.c1, column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2)), t2.c3)]), filter(nil), rowset=16
  1 - output([INTERNAL_FUNCTION(t2.c1, column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2)), t2.c3)]), filter(nil), rowset=16
      dop=1
  2 - output([t2.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2))], [t2.c3]), filter(nil), rowset=16
      force partition granule
  3 - output([t2.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2))], [t2.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t2.c1, 2)) = 'cde' OR column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2)) = 'aaaa']), rowset=16
      access([t2.c1], [t2.c3]), partitions(p0, p2)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t2.c1]), range(MIN ; MAX)always true

select * from t2 where c2 = 'cde' or c2 = 'aaaa';
+-------+------+------+
| c1    | c2   | c3   |
+-------+------+------+
| bcde  | cde  |    1 |
| baaaa | aaaa |    1 |
+-------+------+------+

explain basic select * from t2 where c1 = 'bcde' and (c2 = 'cde' or c2 = 'aaaa');
Query Plan
===================
|ID|OPERATOR |NAME|
-------------------
|0 |TABLE GET|t2  |
===================
Outputs & filters:
-------------------------------------
  0 - output([t2.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2))], [t2.c3]), filter([column_conv(VARCHAR,utf8mb4_general_ci,
      length:8,NULL,substr(t2.c1, 2)) = 'cde' OR column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2)) = 'aaaa']), rowset=16
      access([t2.c1], [t2.c3]), partitions(p0)
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t2.c1]), range[bcde ; bcde],
      range_cond([t2.c1 = 'bcde'])

select * from t2 where c1 = 'bcde' and (c2 = 'cde' or c2 = 'aaaa');
+------+------+------+
| c1   | c2   | c3   |
+------+------+------+
| bcde | cde  |    1 |
+------+------+------+

explain basic select * from t2 where c1 = 'baaaa';
Query Plan
===================
|ID|OPERATOR |NAME|
-------------------
|0 |TABLE GET|t2  |
===================
Outputs & filters:
-------------------------------------
  0 - output([t2.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t2.c1, 2))], [t2.c3]), filter(nil), rowset=16
      access([t2.c1], [t2.c3]), partitions(p2)
      is_index_back=false, is_global_index=false,
      range_key([t2.c1]), range[baaaa ; baaaa],
      range_cond([t2.c1 = 'baaaa'])

select * from t2 where c1 = 'baaaa';
+-------+------+------+
| c1    | c2   | c3   |
+-------+------+------+
| baaaa | aaaa |    1 |
+-------+------+------+

create table t3(c1 varchar(10), c2 varchar(8) generated always as (substring(c1, 2)) virtual, c3 int, unique key t31(c3, c1, c2) local) partition by key(c2, c3) partitions 5;

explain basic select * from t3 where c1 = 'bcde';
Query Plan
=======================================
|ID|OPERATOR                 |NAME    |
---------------------------------------
|0 |PX COORDINATOR           |        |
|1 |└─EXCHANGE OUT DISTR     |:EX10000|
|2 |  └─PX PARTITION ITERATOR|        |
|3 |    └─TABLE FULL SCAN    |t3      |
=======================================
Outputs & filters:
-------------------------------------
  0 - output([INTERNAL_FUNCTION(t3.c1, column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t3.c1, 2)), t3.c3)]), filter(nil), rowset=16
  1 - output([INTERNAL_FUNCTION(t3.c1, column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t3.c1, 2)), t3.c3)]), filter(nil), rowset=16
      dop=1
  2 - output([t3.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t3.c1, 2))], [t3.c3]), filter(nil), rowset=16
      force partition granule
  3 - output([t3.c1], [column_conv(VARCHAR,utf8mb4_general_ci,length:8,NULL,substr(t3.c1, 2))], [t3.c3]), filter([t3.c1 = 'bcde']), rowset=16
      access([t3.c1], [t3.c3]), partitions(p[0-4])
      is_index_back=false, is_global_index=false, filter_before_indexback[false],
      range_key([t3.__pk_increment]), range(MIN ; MAX)always true

drop table t1, t2, t3;

drop table if exists test;
create table test(pk1 int, pk2 int, first_name varchar(100), last_name varchar(100), primary key(pk1, pk2));
insert into test values(1,1, 'first                     1', 'last                    1');
create index test_index ON test(first_name(10));
insert into test(pk1,pk2,first_name,last_name) values (1, 1, 'first                     1', 'last                    2') on duplicate key update first_name = 'dtew';
select * from test;
+-----+-----+------------+---------------------------+
| pk1 | pk2 | first_name | last_name                 |
+-----+-----+------------+---------------------------+
|   1 |   1 | dtew       | last                    1 |
+-----+-----+------------+---------------------------+
drop table test;

drop table if exists test_36;
create table test_36(pk1 int, pk2 int, first_name varchar(100), last_name varchar(100), primary key(pk1, pk2)) COMPRESSION='zstd_1.0';
create index test_36_index ON test_36(first_name(10));
insert into test_36 values(1,1, 'first                     1', 'last                    1');
Replace into test_36(pk1,pk2,first_name,last_name) values (1, 1, 'first                     1', 'last                    2');
select * from test_36;
+-----+-----+-----------------------------+---------------------------+
| pk1 | pk2 | first_name                  | last_name                 |
+-----+-----+-----------------------------+---------------------------+
|   1 |   1 | first                     1 | last                    2 |
+-----+-----+-----------------------------+---------------------------+
drop table test_36;

drop table if exists t1;
create table t1(a int, b varchar(10));
insert into t1 values(1, '1');
alter table t1 add column c int as (a*b);
delete from t1;
drop table t1;

drop table if exists pmt_pay_ord_00;
create table pmt_pay_ord_00 ( payment_id varchar(32) primary key, apply_id varchar(32), partition_id varchar(2) GENERATED ALWAYS AS (substring(payment_id,14,2)), constraint cst check (partition_id=substring(apply_id,14, 2)) ) partition by list columns (partition_id) ( partition p0 values in ('00'), partition p1 values in ('01'), partition p2 values in ('02'));
insert into pmt_pay_ord_00(payment_id,apply_id) values('000000000000001','000000000000001');
select * from pmt_pay_ord_00;
+-----------------+-----------------+--------------+
| payment_id      | apply_id        | partition_id |
+-----------------+-----------------+--------------+
| 000000000000001 | 000000000000001 | 01           |
+-----------------+-----------------+--------------+
drop table pmt_pay_ord_00;

drop table if exists base_table_virtual_1;
create table if not exists base_table_virtual_1( c1 varchar(10) primary key, c2 varchar(8) generated always as (substring(c1, 2)) virtual, c3 int) partition by key(c2) partitions 5;
insert into base_table_virtual_1 (c1, c3) values('abcde', 10);
select * from base_table_virtual_1;
+-------+------+------+
| c1    | c2   | c3   |
+-------+------+------+
| abcde | bcde |   10 |
+-------+------+------+
drop table base_table_virtual_1;

drop database if exists jx_db;
create database jx_db;
use jx_db;
##
create table jx_t1(
    obschema_c_0_S bigint(255) NOT NULL default 3,
    obschema_c_1_E24tu tinyint(255) NOT NULL default 1,
    obschema_c_2_JERyw datetime(6) NOT NULL default now(6),
    obschema_c_3_HsEpzXX varchar(1024) NULL default NULL,
    obschema_c_4_kJ4j4z year(4) NULL default NULL,
    obschema_c_5_z varchar(1024) NOT NULL,
    primary key(obschema_c_0_S,obschema_c_1_E24tu),
    index obschema_i_0_o(obschema_c_3_HsEpzXX(5),obschema_c_4_kJ4j4z,obschema_c_5_z(213)) LOCAL ,
    index obschema_i_1_4Q(obschema_c_1_E24tu,obschema_c_2_JERyw,obschema_c_3_HsEpzXX(84),obschema_c_4_kJ4j4z,obschema_c_5_z(183)) LOCAL ) ;
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t1' and b.database_name='jx_db')
    order by column_id, prev_column_id;
+-----------+----------------------+--------------------+-------------------+----------------+
| column_id | column_name          | orig_default_value | cur_default_value | prev_column_id |
+-----------+----------------------+--------------------+-------------------+----------------+
|        16 | obschema_c_0_S       | NULL               | NULL              |              0 |
|        17 | obschema_c_1_E24tu   | NULL               | NULL              |             16 |
|        18 | obschema_c_2_JERyw   | NULL               | NULL              |             17 |
|        19 | obschema_c_3_HsEpzXX | NULL               | NULL              |             18 |
|        20 | obschema_c_4_kJ4j4z  | NULL               | NULL              |             19 |
|        21 | obschema_c_5_z       | NULL               | NULL              |             20 |
|        22 | __substr5_19         | NULL               | NULL              |             21 |
|        23 | __substr213_21       | NULL               | NULL              |             22 |
|        24 | __substr84_19        | NULL               | NULL              |             23 |
|        25 | __substr183_21       | NULL               | NULL              |             24 |
+-----------+----------------------+--------------------+-------------------+----------------+
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table
    where data_table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t1' and b.database_name='jx_db'))
    order by column_id, prev_column_id;
+-----------+---------------------+--------------------+-------------------+----------------+
| column_id | column_name         | orig_default_value | cur_default_value | prev_column_id |
+-----------+---------------------+--------------------+-------------------+----------------+
|        16 | obschema_c_0_S      | NULL               | NULL              |             23 |
|        16 | obschema_c_0_S      | NULL               | NULL              |             25 |
|        17 | obschema_c_1_E24tu  | NULL               | NULL              |              0 |
|        17 | obschema_c_1_E24tu  | NULL               | NULL              |             16 |
|        18 | obschema_c_2_JERyw  | NULL               | NULL              |             17 |
|        20 | obschema_c_4_kJ4j4z | NULL               | NULL              |             22 |
|        20 | obschema_c_4_kJ4j4z | NULL               | NULL              |             24 |
|        22 | __substr5_19        | NULL               | NULL              |              0 |
|        23 | __substr213_21      | NULL               | NULL              |             20 |
|        24 | __substr84_19       | NULL               | NULL              |             18 |
|        25 | __substr183_21      | NULL               | NULL              |             20 |
+-----------+---------------------+--------------------+-------------------+----------------+

alter table jx_t1
    change column obschema_c_0_S obschema_c_0_AOA0Kr bigint(255) NOT NULL default 3,
    change column obschema_c_1_E24tu obschema_c_1_WVgnv tinyint(255) NOT NULL default 1,
    change column obschema_c_2_JERyw obschema_c_2_7 datetime(6) NOT NULL default now(6),
    change column obschema_c_3_HsEpzXX obschema_c_3_lcWP varchar(1024) NULL default NULL,
    change column obschema_c_4_kJ4j4z obschema_c_4_U year(4) NULL default NULL,
    change column obschema_c_5_z obschema_c_5_Oz varchar(1024) NOT NULL;
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t1' and b.database_name='jx_db')
    order by column_id, prev_column_id;
+-----------+---------------------+--------------------+-------------------+----------------+
| column_id | column_name         | orig_default_value | cur_default_value | prev_column_id |
+-----------+---------------------+--------------------+-------------------+----------------+
|        16 | obschema_c_0_AOA0Kr | NULL               | NULL              |              0 |
|        17 | obschema_c_1_WVgnv  | NULL               | NULL              |             16 |
|        18 | obschema_c_2_7      | NULL               | NULL              |             17 |
|        19 | obschema_c_3_lcWP   | NULL               | NULL              |             18 |
|        20 | obschema_c_4_U      | NULL               | NULL              |             19 |
|        21 | obschema_c_5_Oz     | NULL               | NULL              |             20 |
|        22 | __substr5_19        | NULL               | NULL              |             21 |
|        23 | __substr213_21      | NULL               | NULL              |             22 |
|        24 | __substr84_19       | NULL               | NULL              |             23 |
|        25 | __substr183_21      | NULL               | NULL              |             24 |
+-----------+---------------------+--------------------+-------------------+----------------+
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table
    where data_table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t1' and b.database_name='jx_db'))
    order by column_id, prev_column_id;
+-----------+---------------------+--------------------+-------------------+----------------+
| column_id | column_name         | orig_default_value | cur_default_value | prev_column_id |
+-----------+---------------------+--------------------+-------------------+----------------+
|        16 | obschema_c_0_AOA0Kr | NULL               | NULL              |              0 |
|        16 | obschema_c_0_AOA0Kr | NULL               | NULL              |              0 |
|        17 | obschema_c_1_WVgnv  | NULL               | NULL              |             16 |
|        17 | obschema_c_1_WVgnv  | NULL               | NULL              |             16 |
|        18 | obschema_c_2_7      | NULL               | NULL              |             17 |
|        20 | obschema_c_4_U      | NULL               | NULL              |             19 |
|        20 | obschema_c_4_U      | NULL               | NULL              |             19 |
|        22 | __substr5_19        | NULL               | NULL              |              0 |
|        23 | __substr213_21      | NULL               | NULL              |             20 |
|        24 | __substr84_19       | NULL               | NULL              |             18 |
|        25 | __substr183_21      | NULL               | NULL              |             20 |
+-----------+---------------------+--------------------+-------------------+----------------+

insert into jx_t1 values(1, 2, '20180415', 'hello', '2018', 'ant');
desc jx_t1;
+---------------------+---------------+------+-----+----------------------+-------+
| Field               | Type          | Null | Key | Default              | Extra |
+---------------------+---------------+------+-----+----------------------+-------+
| obschema_c_0_AOA0Kr | bigint(255)   | NO   | PRI | 3                    |       |
| obschema_c_1_WVgnv  | tinyint(255)  | NO   | PRI | 1                    |       |
| obschema_c_2_7      | datetime(6)   | NO   |     | CURRENT_TIMESTAMP(6) |       |
| obschema_c_3_lcWP   | varchar(1024) | YES  |     | NULL                 |       |
| obschema_c_4_U      | year(4)       | YES  |     | NULL                 |       |
| obschema_c_5_Oz     | varchar(1024) | NO   |     | NULL                 |       |
+---------------------+---------------+------+-----+----------------------+-------+
show columns from jx_t1;
Field	Type	Null	Key	Default	Extra
obschema_c_0_AOA0Kr	bigint(255)	NO	PRI	3
obschema_c_1_WVgnv	tinyint(255)	NO	PRI	1
obschema_c_2_7	datetime(6)	NO		CURRENT_TIMESTAMP(6)
obschema_c_3_lcWP	varchar(1024)	YES		NULL
obschema_c_4_U	year(4)	YES		NULL
obschema_c_5_Oz	varchar(1024)	NO		NULL
show create table jx_t1;
Table	Create Table
jx_t1	CREATE TABLE `jx_t1` (
  `obschema_c_0_AOA0Kr` bigint(255) NOT NULL DEFAULT '3',
  `obschema_c_1_WVgnv` tinyint(255) NOT NULL DEFAULT '1',
  `obschema_c_2_7` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `obschema_c_3_lcWP` varchar(1024) DEFAULT NULL,
  `obschema_c_4_U` year(4) DEFAULT NULL,
  `obschema_c_5_Oz` varchar(1024) NOT NULL,
  PRIMARY KEY (`obschema_c_0_AOA0Kr`, `obschema_c_1_WVgnv`),
  KEY `obschema_i_0_o` (`obschema_c_3_lcWP`(5), `obschema_c_4_U`, `obschema_c_5_Oz`(213)) BLOCK_SIZE 16384 LOCAL,
  KEY `obschema_i_1_4Q` (`obschema_c_1_WVgnv`, `obschema_c_2_7`, `obschema_c_3_lcWP`(84), `obschema_c_4_U`, `obschema_c_5_Oz`(183)) BLOCK_SIZE 16384 LOCAL
) ORGANIZATION INDEX DEFAULT CHARSET = utf8mb4 COMPRESSION = 'lz4_1.0' REPLICA_NUM = NUM BLOCK_SIZE = SIZE USE_BLOOM_FILTER = FALSE ENABLE_MACRO_BLOCK_BLOOM_FILTER = FALSE TABLET_SIZE = SIZE PCTFREE = 10
select * from jx_t1;
+---------------------+--------------------+----------------------------+-------------------+----------------+-----------------+
| obschema_c_0_AOA0Kr | obschema_c_1_WVgnv | obschema_c_2_7             | obschema_c_3_lcWP | obschema_c_4_U | obschema_c_5_Oz |
+---------------------+--------------------+----------------------------+-------------------+----------------+-----------------+
|                   1 |                  2 | 2018-04-15 00:00:00.000000 | hello             |           2018 | ant             |
+---------------------+--------------------+----------------------------+-------------------+----------------+-----------------+
select obschema_c_3_lcWP, obschema_c_5_Oz from jx_t1;
+-------------------+-----------------+
| obschema_c_3_lcWP | obschema_c_5_Oz |
+-------------------+-----------------+
| hello             | ant             |
+-------------------+-----------------+

create table jx_t2(c1 int, c2 varchar(20), index idx(c2(5)), index idx2(c2(7)));
alter table jx_t2 change column c2 col2 varchar(20);
drop index idx on jx_t2;
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table
    where data_table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t2' and b.database_name='jx_db'))
    order by column_id, prev_column_id;
+-----------+----------------+--------------------+-------------------+----------------+
| column_id | column_name    | orig_default_value | cur_default_value | prev_column_id |
+-----------+----------------+--------------------+-------------------+----------------+
|         1 | __pk_increment | NULL               | NULL              |             19 |
|        19 | __substr7_17   | NULL               | NULL              |              0 |
+-----------+----------------+--------------------+-------------------+----------------+

create table jx_t3(c1 int, c2 varchar(20), c3 char(50), index idx(c2(5)), index idx2(c2(7)));
alter table jx_t3 add index idx3(c3(20));
alter table jx_t3 change column c2 col2 varchar(20);
alter table jx_t3 change column c3 col3 char(50);
drop index idx on jx_t3;
drop index idx2 on jx_t3;
select column_id, column_name, orig_default_value, cur_default_value, prev_column_id from oceanbase.__all_virtual_column
    where table_id in (select table_id from oceanbase.__all_virtual_table
    where data_table_id in (select table_id from oceanbase.__all_virtual_table a left join oceanbase.__all_virtual_database b on a.database_id=b.database_id
        where a.table_name = 'jx_t3' and b.database_name='jx_db'))
    order by column_id, prev_column_id;
+-----------+----------------+--------------------+-------------------+----------------+
| column_id | column_name    | orig_default_value | cur_default_value | prev_column_id |
+-----------+----------------+--------------------+-------------------+----------------+
|         1 | __pk_increment | NULL               | NULL              |             21 |
|        21 | __substr20_18  | NULL               | NULL              |              0 |
+-----------+----------------+--------------------+-------------------+----------------+

create table t1(c1 varchar (1000) DEFAULT '', key ic1 (c1(255)));
select column_name, orig_default_value, cur_default_value from oceanbase.__all_virtual_column where table_id= 1111;
+----------------+--------------------+-------------------+
| column_name    | orig_default_value | cur_default_value |
+----------------+--------------------+-------------------+
| __pk_increment | NULL               | NULL              |
| c1             | NULL               | NULL              |
| __substr255_16 | NULL               | NULL              |
+----------------+--------------------+-------------------+
select column_name, orig_default_value, cur_default_value from oceanbase.__all_virtual_column where table_id= 1111;
+----------------+--------------------+-------------------+
| column_name    | orig_default_value | cur_default_value |
+----------------+--------------------+-------------------+
| __pk_increment | NULL               | NULL              |
| __substr255_16 | NULL               | NULL              |
+----------------+--------------------+-------------------+
insert into t1 values ('wang');
select * from t1;
+------+
| c1   |
+------+
| wang |
+------+

create table t2( c1 varchar (1000) DEFAULT 'wang', c2 int, key ic1 (c1(255)));
select column_name, orig_default_value, cur_default_value from oceanbase.__all_virtual_column where table_id= 1111;
+----------------+--------------------+-------------------+
| column_name    | orig_default_value | cur_default_value |
+----------------+--------------------+-------------------+
| __pk_increment | NULL               | NULL              |
| c1             | NULL               | NULL              |
| c2             | NULL               | NULL              |
| __substr255_16 | NULL               | NULL              |
+----------------+--------------------+-------------------+
select column_name, orig_default_value, cur_default_value from oceanbase.__all_virtual_column where table_id= 1111;
+----------------+--------------------+-------------------+
| column_name    | orig_default_value | cur_default_value |
+----------------+--------------------+-------------------+
| __pk_increment | NULL               | NULL              |
| __substr255_16 | NULL               | NULL              |
+----------------+--------------------+-------------------+
insert into t2(c2) values (1);
select * from t2;
+------+------+
| c1   | c2   |
+------+------+
| wang |    1 |
+------+------+

create table t(a varchar(10), c int primary key);
insert into t(a, c) values(1, 1);
alter table t add column b binary(10) as (concat(a, '6'));
select * from t;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	jx_db	t	t	a	a	253	40	1	Y	0	0	45
def	jx_db	t	t	c	c	3	11	1	N	49155	0	63
def	jx_db	t	t	b	b	254	10	10	Y	128	0	63
+------+---+------------+
| a    | c | b          |
+------+---+------------+
| 1    | 1 | 16         |
+------+---+------------+
delete from t;
insert into t(a, c) values(1, 1);
select * from t;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	jx_db	t	t	a	a	253	40	1	Y	0	0	45
def	jx_db	t	t	c	c	3	11	1	N	49155	0	63
def	jx_db	t	t	b	b	254	10	10	Y	128	0	63
+------+---+------------+
| a    | c | b          |
+------+---+------------+
| 1    | 1 | 16         |
+------+---+------------+
delete from t;
create index t_c on t(c) partition by hash(c) partitions 3;
insert into t(a, c) values(1, 1);
select * from t;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	jx_db	t	t	a	a	253	40	1	Y	0	0	45
def	jx_db	t	t	c	c	3	11	1	N	49163	0	63
def	jx_db	t	t	b	b	254	10	10	Y	128	0	63
+------+---+------------+
| a    | c | b          |
+------+---+------------+
| 1    | 1 | 16         |
+------+---+------------+
delete from t;
select * from t;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	jx_db	t	t	a	a	253	40	0	Y	0	0	45
def	jx_db	t	t	c	c	3	11	0	N	49163	0	63
def	jx_db	t	t	b	b	254	10	0	Y	128	0	63
+------+---+------+
| a    | c | b    |
+------+---+------+
+------+---+------+
drop database jx_db;
